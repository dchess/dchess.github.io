<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-08-20">

<title>dchess.org - SQL Basics using DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">dchess.org</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://drive.google.com/file/d/1O0-Le26SdL-DhDo2LsOQVWR5BAV4I17F/view" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dchess" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/dchess" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">SQL Basics using DuckDB</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">tutorial</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 20, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>I’ve been wanting to put together a simple resource for learning the basics of querying data with SQL for some time now. However, one of the roadblocks has been the overhead of initial setup instructions for creating a database to query from. Even cloud options have hurdles that prevent just jumping in and writing SQL.</p>
<section id="duckdb-simple-and-effective" class="level2">
<h2 class="anchored" data-anchor-id="duckdb-simple-and-effective">DuckDB: Simple and Effective</h2>
<p>One of my favorite new tools is <a href="https://duckdb.org/">DuckDB</a>. Especially when combined with pandas dataframes. It enables me to use pandas to quickly read a data source into a dataframe and then shift away from the often confusing array of pandas querying syntax and shift back to something I am most comfortable with in my data analysis toolbelt: SQL.</p>
<p>To start, we’ll need some data to work with. Similar to the <a href="../../posts/pandas-yaml-config/">last tutorial</a>, let’s download the <a href="https://nces.ed.gov/ccd/Data/zip/ccd_sch_029_2122_w_1a_071722.zip">2021-2022 NCES national school directory</a> to work with.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> pd.read_csv(<span class="st">"ccd_sch_029_2122_w_1a_071722.csv"</span>, dtype<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert column names to lowercase, </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># because I'm not a fan of my column names screaming at me in ALL CAPS</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>directory.columns <span class="op">=</span> [c.lower() <span class="cf">for</span> c <span class="kw">in</span> directory.columns] </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>directory.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">fipst</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">lea_name</th>
<th data-quarto-table-cell-role="th">state_agency_no</th>
<th data-quarto-table-cell-role="th">union</th>
<th data-quarto-table-cell-role="th">st_leaid</th>
<th data-quarto-table-cell-role="th">leaid</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">g_10_offered</th>
<th data-quarto-table-cell-role="th">g_11_offered</th>
<th data-quarto-table-cell-role="th">g_12_offered</th>
<th data-quarto-table-cell-role="th">g_13_offered</th>
<th data-quarto-table-cell-role="th">g_ug_offered</th>
<th data-quarto-table-cell-role="th">g_ae_offered</th>
<th data-quarto-table-cell-role="th">gslo</th>
<th data-quarto-table-cell-role="th">gshi</th>
<th data-quarto-table-cell-role="th">level</th>
<th data-quarto-table-cell-role="th">igoffered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>07</td>
<td>08</td>
<td>Middle</td>
<td>As reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville High School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>09</td>
<td>12</td>
<td>High</td>
<td>As reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Intermediate School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>05</td>
<td>06</td>
<td>Middle</td>
<td>As reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Elementary School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>03</td>
<td>04</td>
<td>Elementary</td>
<td>As reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Kindergarten and PreK</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>PK</td>
<td>KG</td>
<td>Elementary</td>
<td>As reported</td>
</tr>
</tbody>
</table>

<p>5 rows × 65 columns</p>
</div>
</div>
</div>
</section>
<section id="a-quick-pause-for-vocabulary" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-pause-for-vocabulary">A quick pause for vocabulary</h2>
<p>Before we dive in to writing SQL queries, let’s pause to define a few common terms that will come up.</p>
<ul>
<li><strong>Table</strong>: A table is a fundamental component of a database. It represents a collection of related data organized in rows and columns. Each row in a table is called a record, and each column represents a field.</li>
<li><strong>Field</strong>: A field is a single piece of data within a table. It corresponds to the columns in a table and defines the type of data it can hold, such as text, numbers, dates, or binary data.</li>
<li><strong>Record</strong>: A record, also known as a row, is a complete set of related data in a table. It contains values for each field, representing a single entity or data entry within the database.</li>
<li><strong>Schema</strong>: A schema is a blueprint or structure that defines the organization of a database. It outlines the tables, fields, data types, relationships, and constraints that form the database’s structure.</li>
<li><strong>Query</strong>: A query is a request made to the database to retrieve or manipulate data. It uses a structured query language (SQL) to interact with the database.</li>
</ul>
<section id="understanding-table-schema" class="level3">
<h3 class="anchored" data-anchor-id="understanding-table-schema">Understanding table schema</h3>
<p>Understanding the schema of a table is essential before writing a SQL query. The schema defines the structure of the table, including the names of columns, data types, and constraints. When exploring unfamiliar datasets, understanding the schema provides insights into the available data and helps you identify relevant tables and columns for analysis. It also ensures that you refer to the correct column names and use the appropriate data types in your SQL query, leading to accurate and valid results. Knowing the data types of each column helps you format your query correctly.</p>
<p>For example, when dealing with dates or numerical values, understanding the data types ensures you use the right functions and operators for calculations. When writing queries, you often need to filter or sort data based on certain criteria. Understanding the schema allows you to apply the correct conditions and sorting instructions to retrieve the desired results effectively.</p>
<p>Now, let’s orient ourselves to the data in this dataset and it’s schema. To do so, let’s get a list of columns and get a sense of the data volume.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>directory.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 102130 entries, 0 to 102129
Data columns (total 65 columns):
 #   Column               Non-Null Count   Dtype 
---  ------               --------------   ----- 
 0   school_year          102130 non-null  object
 1   fipst                102130 non-null  object
 2   statename            102130 non-null  object
 3   st                   102130 non-null  object
 4   sch_name             102130 non-null  object
 5   lea_name             102130 non-null  object
 6   state_agency_no      102130 non-null  object
 7   union                2440 non-null    object
 8   st_leaid             102130 non-null  object
 9   leaid                102130 non-null  object
 10  st_schid             102130 non-null  object
 11  ncessch              102130 non-null  object
 12  schid                102130 non-null  object
 13  mstreet1             102130 non-null  object
 14  mstreet2             1672 non-null    object
 15  mstreet3             2 non-null       object
 16  mcity                102130 non-null  object
 17  mstate               102130 non-null  object
 18  mzip                 102130 non-null  object
 19  mzip4                60951 non-null   object
 20  lstreet1             102127 non-null  object
 21  lstreet2             579 non-null     object
 22  lstreet3             4 non-null       object
 23  lcity                102130 non-null  object
 24  lstate               102130 non-null  object
 25  lzip                 102130 non-null  object
 26  lzip4                59351 non-null   object
 27  phone                102130 non-null  object
 28  website              66812 non-null   object
 29  sy_status            102130 non-null  object
 30  sy_status_text       102130 non-null  object
 31  updated_status       102130 non-null  object
 32  updated_status_text  102130 non-null  object
 33  effective_date       102130 non-null  object
 34  sch_type_text        102130 non-null  object
 35  sch_type             102130 non-null  object
 36  recon_status         102130 non-null  object
 37  out_of_state_flag    102130 non-null  object
 38  charter_text         102130 non-null  object
 39  chartauth1           6549 non-null    object
 40  chartauthn1          6553 non-null    object
 41  chartauth2           97 non-null      object
 42  chartauthn2          97 non-null      object
 43  nogrades             102130 non-null  object
 44  g_pk_offered         102130 non-null  object
 45  g_kg_offered         102130 non-null  object
 46  g_1_offered          102130 non-null  object
 47  g_2_offered          102130 non-null  object
 48  g_3_offered          102130 non-null  object
 49  g_4_offered          102130 non-null  object
 50  g_5_offered          102130 non-null  object
 51  g_6_offered          102130 non-null  object
 52  g_7_offered          102130 non-null  object
 53  g_8_offered          102130 non-null  object
 54  g_9_offered          102130 non-null  object
 55  g_10_offered         102130 non-null  object
 56  g_11_offered         102130 non-null  object
 57  g_12_offered         102130 non-null  object
 58  g_13_offered         102130 non-null  object
 59  g_ug_offered         102130 non-null  object
 60  g_ae_offered         102130 non-null  object
 61  gslo                 102130 non-null  object
 62  gshi                 102130 non-null  object
 63  level                102130 non-null  object
 64  igoffered            102130 non-null  object
dtypes: object(65)
memory usage: 50.6+ MB</code></pre>
</div>
</div>
<p>This shows us a number of things:</p>
<ul>
<li>all the column names</li>
<li>their data types (recall we have set all of them to strings, which pandas lists as <code>object</code>)</li>
<li>the number of non-null values in each column</li>
<li>the number of columns: 65</li>
<li>the number of rows: 102,130</li>
<li>it even shows the amount of memory used to hold this data: 50.6 MB</li>
</ul>
</section>
<section id="a-note-about-null" class="level3">
<h3 class="anchored" data-anchor-id="a-note-about-null">A note about null</h3>
<p>In SQL and databases, <code>null</code> represents the absence of a value or unknown data for a specific field in a table. It’s not the same as zero or an empty string and requires special handling in SQL queries. The <code>null</code> value can be used in any data type, whether it’s a string, numeric, date, or any other data type.</p>
<p>Dealing with null values in SQL queries can be tricky, and can lead to unexpected or incorrect results.</p>
</section>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>Now that we have a basic lay-of-the-land for our data, we can begin querying it. At this point, I will shift away from pandas syntax and use SQL queries.</p>
<p>To start, let’s install duckdb.</p>
<pre><code>pip install duckdb</code></pre>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"select * from directory limit 5"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">fipst</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">lea_name</th>
<th data-quarto-table-cell-role="th">state_agency_no</th>
<th data-quarto-table-cell-role="th">union</th>
<th data-quarto-table-cell-role="th">st_leaid</th>
<th data-quarto-table-cell-role="th">leaid</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">g_10_offered</th>
<th data-quarto-table-cell-role="th">g_11_offered</th>
<th data-quarto-table-cell-role="th">g_12_offered</th>
<th data-quarto-table-cell-role="th">g_13_offered</th>
<th data-quarto-table-cell-role="th">g_ug_offered</th>
<th data-quarto-table-cell-role="th">g_ae_offered</th>
<th data-quarto-table-cell-role="th">gslo</th>
<th data-quarto-table-cell-role="th">gshi</th>
<th data-quarto-table-cell-role="th">level</th>
<th data-quarto-table-cell-role="th">igoffered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>07</td>
<td>08</td>
<td>Middle</td>
<td>As reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville High School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>09</td>
<td>12</td>
<td>High</td>
<td>As reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Intermediate School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>05</td>
<td>06</td>
<td>Middle</td>
<td>As reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Elementary School</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>03</td>
<td>04</td>
<td>Elementary</td>
<td>As reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Kindergarten and PreK</td>
<td>Albertville City</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>PK</td>
<td>KG</td>
<td>Elementary</td>
<td>As reported</td>
</tr>
</tbody>
</table>

<p>5 rows × 65 columns</p>
</div>
</div>
</div>
<p>This basic query is equivalent to <code>directory.head()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> <span class="kw">directory</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">limit</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What is each keyword doing here?</p>
<p><code>select</code>: The select keyword is used to specify which columns or expressions to include in the query result. It allows you to choose the data you want to retrieve from the tables in the database. In SQL, the asterisk (<code>*</code>) is used in a <code>select</code> statement to represent all columns in a table.</p>
<p><code>from</code>: The from keyword is used to specify the table from which the data will be retrieved. It tells the query where to find the data to be selected. With duckdb, we can specify a dataframe as the table to be queried.</p>
<p><code>limit</code>: The limit keyword is used to restrict the number of rows returned in the query result. It is particularly useful when you only need to see a small subset of the data.</p>
</section>
<section id="asking-questions" class="level2">
<h2 class="anchored" data-anchor-id="asking-questions">Asking Questions</h2>
<p>SQL Queries are fundamentally a way of interrogating your data. You usually start with a question you want to answer and then form your query (question) is such a way that the database can understand it and return the relevant data.</p>
<p>One of the basic ways to interrogate the data is to constrain it in some way. Filtering the data to show only a subset allows you to begin to identify possible patterns. The <code>where</code> clause is particularly valuable for this purpose.</p>
<p>Let’s translate this question into a SQL query: <em>Which schools in Delaware offer 12th grade enrollment?</em></p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select sch_name</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">  where statename = 'DELAWARE'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">    and g_12_offered = 'Yes'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">  order by sch_name</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sch_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Appoquinimink High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Brandywine High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Brandywine SITE</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Brennen School (The)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Caesar Rodney High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Calloway (Cab) School of the Arts</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Cape Henlopen High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Charter School of Wilmington</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Christiana High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Concord High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Conrad Schools of Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Delaware Military Academy</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Delaware School for the Deaf</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Delcastle Technical High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Delmar High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Dickinson (John) School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Douglass School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Dover High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Early College High School at Del State</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Ennis (Howard T.) School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>First State Military Academy</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Freire Charter School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Glasgow High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Great Oaks Charter School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>Hodgson (Paul M.) Vocational Technical High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>Howard High School of Technology</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Indian River High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>Indian River Intensive Learning Center</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>John S. Charlton School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Kent County Community School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>Kent County Secondary ILC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>Lake Forest High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>Laurel Senior High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>Leach (John G.) School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>MOT Charter School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>McKean (Thomas) High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Meadowood Program</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Middletown High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>Milford Senior High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>Mount Pleasant High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Newark Charter School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Newark High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>Odyssey Charter School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>POLYTECH High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>Penn (William) High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>Positive Outcomes Charter School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>Seaford Senior High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>Smyrna High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>St. Georges Technical High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>Sussex Academy</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>Sussex Central High School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>Sussex Consortium</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>Sussex Orthopedic Program</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>Sussex Technical High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>The Wallace Wallin School</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>Woodbridge High School</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>duPont (Alexis I.) High School</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><em>NOTE:</em> You may have noticed the use of <code>"""</code> in the code above. This enables a string to be broken out across multiple lines which I find easier to read for SQL queries.</p>
<p>What is happening here? Let’s break down this query.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> sch_name <span class="co">-- return only the school name column</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> <span class="kw">directory</span> <span class="co">-- from the data in our dataframe</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> statename <span class="op">=</span> <span class="st">'DELAWARE'</span> <span class="co">-- where the state name is DELAWARE (state names are all caps in the dataset)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">and</span> g_12_offered <span class="op">=</span> <span class="st">'Yes'</span> <span class="co">-- and where grade 12 is offered</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> <span class="kw">by</span> sch_name <span class="co">-- sort the resulting data alphabetically by the school name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, let’s refine this query to identify which of those schools are charter schools or not.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">    sch_name,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">  where statename = 'DELAWARE'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">    and g_12_offered = 'Yes'</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st">  order by sch_name</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">charter_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Appoquinimink High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Brandywine High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Brandywine SITE</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Brennen School (The)</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Caesar Rodney High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Calloway (Cab) School of the Arts</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Cape Henlopen High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Charter School of Wilmington</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Christiana High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Concord High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Conrad Schools of Science</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Delaware Military Academy</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Delaware School for the Deaf</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Delcastle Technical High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Delmar High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Dickinson (John) School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Douglass School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Dover High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Early College High School at Del State</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Ennis (Howard T.) School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>First State Military Academy</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Freire Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Glasgow High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Great Oaks Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>Hodgson (Paul M.) Vocational Technical High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>Howard High School of Technology</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Indian River High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>Indian River Intensive Learning Center</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>John S. Charlton School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Kent County Community School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>Kent County Secondary ILC</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>Lake Forest High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>Laurel Senior High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>Leach (John G.) School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>MOT Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>McKean (Thomas) High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Meadowood Program</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Middletown High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>Milford Senior High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>Mount Pleasant High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Newark Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Newark High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>Odyssey Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>POLYTECH High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>Penn (William) High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>Positive Outcomes Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>Seaford Senior High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>Smyrna High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>St. Georges Technical High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>Sussex Academy</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>Sussex Central High School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>Sussex Consortium</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>Sussex Orthopedic Program</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>Sussex Technical High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>The Wallace Wallin School</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>Woodbridge High School</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>duPont (Alexis I.) High School</td>
<td>No</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And if we want to limit our list to just the charter schools, we can add another filter to the <code>where</code> clause.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">    sch_name,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">  where statename = 'DELAWARE'</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">    and g_12_offered = 'Yes'</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">    and charter_text = 'Yes'</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">  order by sch_name</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">charter_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charter School of Wilmington</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Delaware Military Academy</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Early College High School at Del State</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>First State Military Academy</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Freire Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Great Oaks Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>MOT Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Newark Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Odyssey Charter School</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Positive Outcomes Charter School</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Sussex Academy</td>
<td>Yes</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="counting-a-common-type-of-question-to-ask-about-data" class="level2">
<h2 class="anchored" data-anchor-id="counting-a-common-type-of-question-to-ask-about-data">Counting: A common type of question to ask about data</h2>
<p>After this initial investigation, my curiosity has been piqued. I am wondering how many schools are charters vs.&nbsp;traditional public schools in Delaware (regardless of grades offered). Let’s translate that question into a sql query using some basic aggregation.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">  where statename = 'DELAWARE'</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st">  group by </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">    statename, </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">charter_text</th>
<th data-quarto-table-cell-role="th">num_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DELAWARE</td>
<td>Yes</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>DELAWARE</td>
<td>No</td>
<td>208</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>How does this work?</p>
<p>The <code>count()</code> function, predictably, will count the number of values in a given column (or all records if the <code>*</code> is passed instead). You can further expand this to count only unique school names by using <code>count(distinct sch_name)</code>.</p>
<p>We are also aliasing the count using the <code>as</code> keyword to give the resulting column a name: <code>num_schools</code>.</p>
<p>The <code>group by</code> clause is necessary for this aggregation because it defines the context in which the <code>count()</code> function operates. Without the <code>group by</code> clause, the <code>count()</code> function would treat the entire result set as a single group.</p>
<p>Consider this example instead (without grouping):</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">  where statename = 'DELAWARE'</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>231</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In order to get a count for each value of the <em>Yes/No</em> flag in the <code>charter_text</code> column, we need to group our counts by each of those results. In addition, in order to include the <code>statename</code> in our result set, we need to include it in the grouping as well.</p>
<p>If we wanted to determine the same counts for all states in the dataset, we could simply remove the <code>where</code> clause limiting the data to Delaware.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">  group by </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">    statename, </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">charter_text</th>
<th data-quarto-table-cell-role="th">num_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ALABAMA</td>
<td>No</td>
<td>1553</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ALABAMA</td>
<td>Yes</td>
<td>13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ALASKA</td>
<td>No</td>
<td>478</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ALASKA</td>
<td>Yes</td>
<td>31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARIZONA</td>
<td>No</td>
<td>1909</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>GUAM</td>
<td>Yes</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101</td>
<td>NORTHERN MARIANAS</td>
<td>Not applicable</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">102</td>
<td>PUERTO RICO</td>
<td>No</td>
<td>846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">103</td>
<td>PUERTO RICO</td>
<td>Yes</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">104</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>Not applicable</td>
<td>23</td>
</tr>
</tbody>
</table>

<p>105 rows × 3 columns</p>
</div>
</div>
</div>
<p>This gives us some sense of the breakdown, but it actually might be useful to rephrase our question as: <em>What number and percent of schools in each state are charter schools?</em></p>
<p>With that additional clarity, we can refine our query a bit using some conditional logic.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">    count(</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">        if(charter_text = 'Yes', sch_name, null)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="st">    ) as num_charter_schools,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">  group by statename</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">  order by statename</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>That gets us the counts of charter schools in each state as well as the total number of schools in each state. Let’s breakdown what this is doing:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(charter_text <span class="op">=</span> <span class="st">'Yes'</span>, sch_name, <span class="kw">null</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>) <span class="kw">as</span> num_charter_schools,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>if()</code> function checks whether a statement evaluates to <code>true</code> or not and then returns one value for <code>true</code> and another for <code>false</code>. Here, we are leveraging that functionality to count the school name if the value of the <code>charter_text</code> column is <code>Yes</code> but returning <code>null</code> if not. That works because the <code>count()</code> function ignores <code>null</code> values when aggregating.</p>
<p>A similar, but slightly different approach could be done using the <code>sum()</code> function instead:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(charter_text <span class="op">=</span> <span class="st">'Yes'</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>) <span class="kw">as</span> num_charter_schools,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This would treat each charter school as being equivalent to the value <code>1</code> and each non-charter schools as equivalent to the value <code>0</code> and then would add them up. The result is the same in this case. There can be subtle differences in the approach depending on the data being aggregated. It can be useful, at times, to compare the resulting differences (if any).</p>
<section id="calculating-the-percentage-of-schools" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-percentage-of-schools">Calculating the percentage of schools</h3>
<p>We have our counts now, but we don’t have the percentage of schools and that is ultimately the question we are asking. To determine that, we need to divide the number of charters in each state by the total number of schools.</p>
<p>We could do that like this:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">    count(if(charter_text = 'Yes', sch_name, null)) as num_charter_schools,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">    count(if(charter_text = 'Yes', sch_name, null))/count(sch_name) as percent_of_schools,</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">  group by statename</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">  order by statename</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
<td>0.008301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
<td>0.060904</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>0.240954</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
<td>0.084622</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>0.127869</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>0.136735</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
<td>0.020813</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
<td>0.099567</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
<td>0.514403</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>0.178124</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
<td>0.040825</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>0.068182</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
<td>0.125000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
<td>0.101124</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
<td>0.031300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
<td>0.062597</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
<td>0.001500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
<td>0.006618</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
<td>0.108460</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
<td>0.021595</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
<td>0.034410</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
<td>0.041958</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>0.108123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>0.110350</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
<td>0.006641</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
<td>0.032807</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
<td>0.128739</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
<td>0.078313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
<td>0.033695</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
<td>0.114094</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>0.068360</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
<td>0.080651</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>0.088100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
<td>0.039933</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
<td>0.102326</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
<td>0.062099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
<td>0.008206</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
<td>0.128527</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
<td>0.072205</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
<td>0.062662</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>0.109407</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
<td>0.125557</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
<td>0.003277</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
<td>0.006638</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
<td>0.004286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>0.107380</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
<td>0.013661</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Not bad, but I find that decimal representation of the percentage a bit harder to read. Let’s transform that to look like <code>12.5%</code> by:</p>
<ul>
<li>multiplying the decimal by 100 to get a whole number</li>
<li>rounding to a single decimal digit</li>
<li>converting it to a string and adding the <code>%</code> sign</li>
</ul>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="st">    count(if(charter_text = 'Yes', sch_name, null)) as num_charter_schools,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as num_schools,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="st">    concat(cast(round((count(if(charter_text = 'Yes', sch_name, null))/count(sch_name)) * 100, 1) as string), '%') as percent_of_schools,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">  group by statename</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st">  order by statename</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
<td>0.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
<td>6.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>24.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
<td>8.5%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>12.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>13.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
<td>2.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
<td>10.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
<td>51.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>17.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
<td>4.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
<td>12.5%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
<td>10.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
<td>3.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
<td>6.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
<td>0.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
<td>10.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
<td>2.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
<td>3.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
<td>4.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>10.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>11.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
<td>3.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
<td>12.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
<td>7.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
<td>3.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
<td>11.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
<td>8.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>8.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
<td>4.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
<td>10.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
<td>6.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
<td>0.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
<td>12.9%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
<td>7.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
<td>6.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>10.9%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
<td>12.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
<td>0.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
<td>0.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>10.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
<td>1.4%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="cleaning-this-up-for-readability" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-this-up-for-readability">Cleaning this up for readability</h2>
<p>At this point we have a working query, but the syntax is getting a bit dense and hard to read. I’d like to break this up a bit to make it more clear what is happening.</p>
<p>Our code has three main steps:</p>
<ol type="1">
<li>calculate the counts of charter schools and all schools for each state</li>
<li>divide the counts to calculate a percentage value as decimal</li>
<li>transform the decimal value to a string representation of the percentage</li>
</ol>
<p>We can use nested subqueries to do this, but I consider that an anti-pattern in SQL and prefer the use of CTEs (common table expressions). They allow us to designate a query to be an intermediate result that can be further queried.</p>
<section id="new-vocabulary" class="level3">
<h3 class="anchored" data-anchor-id="new-vocabulary">New Vocabulary</h3>
<ul>
<li><strong>Common Table Expression (CTE)</strong> is a temporary result set that is defined within the scope of a single SQL statement. It allows you to create a named query that can be referenced multiple times within the main query. CTEs are primarily used to improve the readability, modularity, and reusability of SQL queries</li>
</ul>
</section>
<section id="note-subqueries-as-an-anti-pattern" class="level3">
<h3 class="anchored" data-anchor-id="note-subqueries-as-an-anti-pattern"><em>Note: Subqueries as an anti-pattern</em></h3>
<p>Using nested subqueries in SQL can become an anti-pattern because it can lead to complex, hard-to-maintain queries and potential performance issues. Nested subqueries involve placing one query inside another, often making the overall query difficult to read, understand, and optimize. While nested subqueries can solve specific problems, using them excessively can lead to unreadable, inefficient, and hard-to-maintain SQL queries. It’s generally better to explore alternative techniques like joins, CTEs, and window functions for clearer, more optimized code.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="st">  with school_counts as (</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="st">    select </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">      statename,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="st">      count(if(charter_text = 'Yes', sch_name, null)) as num_charter_schools,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">      count(sch_name) as num_schools,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">    from directory</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">    group by statename</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">  ),</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">  percents as (</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">      select</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st">        statename,</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">        num_charter_schools,</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">        num_schools,</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">        round((num_charter_schools/num_schools) * 100, 1) as percent_of_schools</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">      from school_counts</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="st">  )</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="st">    num_charter_schools,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="st">    num_schools,</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="st">    concat(cast(percent_of_schools as string),'%') as percent_of_schools</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="st">  from percents</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>charters <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another way to do this that is unique to duckdb would be to store each query into a variable and execute queries against those.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="st">      statename,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">      count(if(charter_text = 'Yes', sch_name, null)) as num_charter_schools,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">      count(sch_name) as num_schools,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">  group by statename</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>school_counts <span class="op">=</span> duckdb.sql(query).df()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">    num_charter_schools,</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">    num_schools,</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">    round((num_charter_schools/num_schools) * 100, 1) as percent_of_schools</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">  from school_counts</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>percents <span class="op">=</span> duckdb.sql(query).df()</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="st">    num_charter_schools,</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="st">    num_schools,</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="st">    concat(cast(percent_of_schools as string),'%') as percent_of_schools</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="st">  from percents</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>charters <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>charters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
<td>0.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
<td>6.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>24.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
<td>8.5%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>12.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>13.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
<td>2.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
<td>10.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
<td>51.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>17.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
<td>4.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
<td>12.5%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
<td>10.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
<td>3.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
<td>6.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
<td>0.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
<td>0.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
<td>10.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
<td>2.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
<td>3.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
<td>4.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>10.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>11.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
<td>0.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
<td>3.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
<td>12.9%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
<td>7.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
<td>3.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
<td>11.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>6.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
<td>8.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>8.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
<td>4.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
<td>10.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
<td>6.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
<td>12.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
<td>7.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
<td>6.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>10.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
<td>12.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
<td>0.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
<td>0.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>10.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
<td>1.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
<td>0.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
<td>0.0%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Either way, we can now see the answer to our initial question. However, at this point a new question has come to mind: <em>Which states have the highest percentage of charter schools?</em></p>
<p>To answer that, we can simply sort the results:</p>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select * </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">  from charters </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">  order by percent_of_schools desc</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>8.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
<td>8.5%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
<td>8.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
<td>7.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
<td>7.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
<td>6.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
<td>6.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
<td>6.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
<td>6.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
<td>51.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
<td>4.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
<td>4.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
<td>4.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
<td>3.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
<td>3.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
<td>3.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
<td>3.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>24.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
<td>2.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
<td>2.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>17.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>13.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
<td>12.9%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
<td>12.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>12.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
<td>12.6%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
<td>12.5%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
<td>11.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>11.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>10.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
<td>10.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>10.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>10.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
<td>10.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
<td>10.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
<td>10.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
<td>1.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
<td>0.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
<td>0.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
<td>0.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
<td>0.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
<td>0.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
<td>0.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
<td>0.0%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Oh no!!!</p>
<p>Our conversion of the percentage into a string has ruined our ability to sort the values. This is why it is so vital to understand data types. Strings are sorted alphabetically but numbers are sorted numerically. What that means in this context is that when sorting descending (reverse), the string <code>"8"</code> is larger than the string <code>"50"</code> because 8 comes after 5. If the value were still numbers that would not be the case.</p>
<p>To resolve this we can preserve the original decimal column for sorting rather than replace it entirely.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">  with school_counts as (</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="st">    select </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">      statename,</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="st">      count(if(charter_text = 'Yes', sch_name, null)) as num_charter_schools,</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">      count(sch_name) as num_schools,</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="st">    from directory</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="st">    group by statename</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="st">  ),</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="st">  percents as (</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">      select</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="st">        statename,</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">        num_charter_schools,</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="st">        num_schools,</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="st">        round((num_charter_schools/num_schools) * 100, 1) as percent_of_schools_numeric</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">      from school_counts</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">  )</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="st">    num_charter_schools,</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="st">    num_schools,</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="st">    concat(cast(percent_of_schools_numeric as string),'%') as percent_of_schools</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="st">  from percents</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="st">  order by percent_of_schools_numeric desc</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DISTRICT OF COLUMBIA</td>
<td>125</td>
<td>243</td>
<td>51.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>24.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>17.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>13.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NEVADA</td>
<td>99</td>
<td>769</td>
<td>12.9%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>RHODE ISLAND</td>
<td>41</td>
<td>319</td>
<td>12.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>12.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>UTAH</td>
<td>141</td>
<td>1123</td>
<td>12.6%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>HAWAII</td>
<td>37</td>
<td>296</td>
<td>12.5%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>NEW MEXICO</td>
<td>102</td>
<td>894</td>
<td>11.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>11.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>10.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>LOUISIANA</td>
<td>150</td>
<td>1383</td>
<td>10.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>10.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>10.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>OREGON</td>
<td>132</td>
<td>1290</td>
<td>10.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>IDAHO</td>
<td>81</td>
<td>801</td>
<td>10.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>DELAWARE</td>
<td>23</td>
<td>231</td>
<td>10.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>8.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1099</td>
<td>8.5%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>NORTH CAROLINA</td>
<td>223</td>
<td>2765</td>
<td>8.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>NEW HAMPSHIRE</td>
<td>39</td>
<td>498</td>
<td>7.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SOUTH CAROLINA</td>
<td>93</td>
<td>1288</td>
<td>7.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>INDIANA</td>
<td>121</td>
<td>1933</td>
<td>6.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>TENNESSEE</td>
<td>121</td>
<td>1931</td>
<td>6.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>PENNSYLVANIA</td>
<td>184</td>
<td>2963</td>
<td>6.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>ALASKA</td>
<td>31</td>
<td>509</td>
<td>6.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1859</td>
<td>4.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>GEORGIA</td>
<td>95</td>
<td>2327</td>
<td>4.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>OKLAHOMA</td>
<td>72</td>
<td>1803</td>
<td>4.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>MARYLAND</td>
<td>49</td>
<td>1424</td>
<td>3.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2582</td>
<td>3.4%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>MISSOURI</td>
<td>81</td>
<td>2469</td>
<td>3.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>ILLINOIS</td>
<td>138</td>
<td>4409</td>
<td>3.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>MAINE</td>
<td>13</td>
<td>602</td>
<td>2.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1009</td>
<td>2.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>WYOMING</td>
<td>5</td>
<td>366</td>
<td>1.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>ALABAMA</td>
<td>13</td>
<td>1566</td>
<td>0.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>853</td>
<td>0.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>KANSAS</td>
<td>9</td>
<td>1360</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1054</td>
<td>0.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2561</td>
<td>0.7%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>WEST VIRGINIA</td>
<td>3</td>
<td>700</td>
<td>0.4%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>VIRGINIA</td>
<td>7</td>
<td>2136</td>
<td>0.3%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>IOWA</td>
<td>2</td>
<td>1333</td>
<td>0.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>KENTUCKY</td>
<td>0</td>
<td>1548</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>MONTANA</td>
<td>0</td>
<td>832</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>NEBRASKA</td>
<td>0</td>
<td>1098</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>NORTH DAKOTA</td>
<td>0</td>
<td>536</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>SOUTH DAKOTA</td>
<td>0</td>
<td>732</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>VERMONT</td>
<td>0</td>
<td>305</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>BUREAU OF INDIAN EDUCATION</td>
<td>0</td>
<td>174</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>AMERICAN SAMOA</td>
<td>0</td>
<td>29</td>
<td>0.0%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>NORTHERN MARIANAS</td>
<td>0</td>
<td>35</td>
<td>0.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>0</td>
<td>23</td>
<td>0.0%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we can see the Washington DC has the highest percent of charter schools by a large margin. That is the legacy of <a href="https://www.usnews.com/opinion/knowledge-bank/articles/2017-04-20/michelle-rhee-set-national-example-of-education-reform-in-washington-dc">Michelle Rhee’s impact on DC schools after passage of the D.C. Public Education Reform Amendment Act in 2007</a>.</p>
</section>
</section>
<section id="the-devil-is-in-the-details" class="level2">
<h2 class="anchored" data-anchor-id="the-devil-is-in-the-details">The Devil is in the details</h2>
<p>While DC might have the largest <em><strong>percent</strong></em> of charter schools it is out of a small number of schools to begin with given the size of Washington DC. If we sort by count we can see that California and Texas have the largest total number of charter schools, but because of the size of the population in those states, the total represents a smaller percentage.</p>
<p>Washington DC is not even in the top 10.</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select * </span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="st">  from charters </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="st">  order by num_charter_schools desc </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="st">  limit 10</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">num_charter_schools</th>
<th data-quarto-table-cell-role="th">num_schools</th>
<th data-quarto-table-cell-role="th">percent_of_schools</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CALIFORNIA</td>
<td>1337</td>
<td>10456</td>
<td>12.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>TEXAS</td>
<td>1056</td>
<td>9652</td>
<td>10.9%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FLORIDA</td>
<td>767</td>
<td>4306</td>
<td>17.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARIZONA</td>
<td>606</td>
<td>2515</td>
<td>24.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MICHIGAN</td>
<td>386</td>
<td>3570</td>
<td>10.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NEW YORK</td>
<td>331</td>
<td>4842</td>
<td>6.8%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>OHIO</td>
<td>325</td>
<td>3689</td>
<td>8.8%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>MINNESOTA</td>
<td>306</td>
<td>2773</td>
<td>11.0%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>COLORADO</td>
<td>268</td>
<td>1960</td>
<td>13.7%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>WISCONSIN</td>
<td>243</td>
<td>2263</td>
<td>10.7%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This begs the question: <em>Which states have the most students in charter schools?</em></p>
<p>Not all school sizes are equal and there could be a large amount of schools with smaller enrollments or fewer schools with larger enrollments. Unfortunately, our initial dataset doesn’t have enrollment information. To determine this, we need new data. Going back to NCES, we can pull the <a href="https://nces.ed.gov/ccd/Data/zip/ccd_SCH_052_2122_l_1a_071722.zip">school membership data</a> as well. This is a much larger dataset (198 MB compressed) than the directory info but doesn’t have as many of the descriptors as our original dataset (such as the charter flag).</p>
<p>To answer this final query, we’ll need to combine the data in these two datasets somehow.</p>
<p>This is where SQL really shines. The sql <code>join</code> is one of the fundamental features of the language that makes it so powerful for data analysis. SQL joins are like puzzle pieces that help you combine information from different tables in a database. They’re useful when you want to see related data together, such as matching customers with their orders or students with their courses. Instead of keeping all the information in one big table, you can split it into smaller ones and then use joins to bring the pieces together, making it easier to understand and work with your data.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="op">=</span> pd.read_csv(<span class="st">"ccd_SCH_052_2122_l_1a_071722.csv"</span>, dtype<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>enrollment.columns <span class="op">=</span> [c.lower() <span class="cf">for</span> c <span class="kw">in</span> enrollment.columns]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>enrollment.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">fipst</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">state_agency_no</th>
<th data-quarto-table-cell-role="th">union</th>
<th data-quarto-table-cell-role="th">st_leaid</th>
<th data-quarto-table-cell-role="th">leaid</th>
<th data-quarto-table-cell-role="th">st_schid</th>
<th data-quarto-table-cell-role="th">ncessch</th>
<th data-quarto-table-cell-role="th">schid</th>
<th data-quarto-table-cell-role="th">grade</th>
<th data-quarto-table-cell-role="th">race_ethnicity</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">student_count</th>
<th data-quarto-table-cell-role="th">total_indicator</th>
<th data-quarto-table-cell-role="th">dms_flag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>0100870</td>
<td>Grade 7</td>
<td>American Indian or Alaska Native</td>
<td>Female</td>
<td>1</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
<td>Reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>0100870</td>
<td>Grade 7</td>
<td>American Indian or Alaska Native</td>
<td>Male</td>
<td>3</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
<td>Reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>0100870</td>
<td>Grade 7</td>
<td>Asian</td>
<td>Female</td>
<td>2</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
<td>Reported</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>0100870</td>
<td>Grade 7</td>
<td>Asian</td>
<td>Male</td>
<td>2</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
<td>Reported</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>01</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>01</td>
<td>NaN</td>
<td>AL-101</td>
<td>0100005</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>0100870</td>
<td>Grade 7</td>
<td>Black or African American</td>
<td>Female</td>
<td>7</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
<td>Reported</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="exploring-enrollment" class="level2">
<h2 class="anchored" data-anchor-id="exploring-enrollment">Exploring Enrollment</h2>
<p>My goal here is to simply pull out the school-wide total enrollment for each school, but a quick scan of that dataframe preview indicates this data is pretty granular. It is broken out into grade levels, each student group for race/ethnicity, and even sex. But I do see there is a column called <code>total_indicator</code> that might be useful. I’d like to get a sense of what the values of that column are so I can determine if it could be used to filter the data somehow. To do that I will query the <code>distinct</code> values in that column.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'max_colwidth'</span>, <span class="dv">0</span>) <span class="co"># this is to make sure pandas doesn't truncate the text in the column</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">select distinct</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">  total_indicator</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="st">from enrollment</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_indicator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Category Set A - By Race/Ethnicity; Sex; Grade</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Derived - Education Unit Total minus Adult Education Count</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Derived - Subtotal by Race/Ethnicity and Sex minus Adult Education Count</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Education Unit Total</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Subtotal 4 - By Grade</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that there are two values that might work here: - Education Unit Total - Derived - Education Unit Total minus Adult Education Count</p>
<p>We can use the first as it seems more straight-forward and includes the full number of students (including adult ed).</p>
<p>Before we do that, let’s pull out the relevant data from the dataset that we want to join to our directory data.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="st">    school_year,</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="st">    st,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="st">    sch_name,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="st">    st_schid,</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="st">    ncessch,</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="st">    student_count,</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="st">  from enrollment</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="st">  where total_indicator = 'Education Unit Total'</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>total_enrollment <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>total_enrollment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">st_schid</th>
<th data-quarto-table-cell-role="th">ncessch</th>
<th data-quarto-table-cell-role="th">student_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>920</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville High School</td>
<td>AL-101-0020</td>
<td>010000500871</td>
<td>1665</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Intermediate School</td>
<td>AL-101-0110</td>
<td>010000500879</td>
<td>924</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Elementary School</td>
<td>AL-101-0200</td>
<td>010000500889</td>
<td>891</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Kindergarten and PreK</td>
<td>AL-101-0035</td>
<td>010000501616</td>
<td>579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100024</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>LOCKHART ELEMENTARY SCHOOL</td>
<td>VI-001-15</td>
<td>780003000024</td>
<td>284</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100025</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>ULLA F MULLER ELEMENTARY SCHOOL</td>
<td>VI-001-17</td>
<td>780003000026</td>
<td>437</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100026</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>YVONNE BOWSKY ELEMENTARY SCHOOL</td>
<td>VI-001-23</td>
<td>780003000027</td>
<td>381</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100027</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>CANCRYN JUNIOR HIGH SCHOOL</td>
<td>VI-001-25</td>
<td>780003000033</td>
<td>744</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100028</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>BERTHA BOSCHULTE JUNIOR HIGH</td>
<td>VI-001-9</td>
<td>780003000034</td>
<td>515</td>
</tr>
</tbody>
</table>

<p>100029 rows × 7 columns</p>
</div>
</div>
</div>
<p>I’m going to include a few different fields that may be necessary for joining such as the <code>school_year</code>, <code>statename</code>, and a couple of different identifiers since we’re not 100% sure which one is unique enough to join yet.</p>
<p>We can do the same to the directory data and just keep the relevant fields for our analysis.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="st">    school_year,</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="st">    st,</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="st">    sch_name,</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="st">    st_schid,</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="st">    ncessch,</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="st">    charter_text</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>directory_info <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>directory_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">st_schid</th>
<th data-quarto-table-cell-role="th">ncessch</th>
<th data-quarto-table-cell-role="th">charter_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Middle School</td>
<td>AL-101-0010</td>
<td>010000500870</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville High School</td>
<td>AL-101-0020</td>
<td>010000500871</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Intermediate School</td>
<td>AL-101-0110</td>
<td>010000500879</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Elementary School</td>
<td>AL-101-0200</td>
<td>010000500889</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Kindergarten and PreK</td>
<td>AL-101-0035</td>
<td>010000501616</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">102125</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>LOCKHART ELEMENTARY SCHOOL</td>
<td>VI-001-15</td>
<td>780003000024</td>
<td>Not applicable</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">102126</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>ULLA F MULLER ELEMENTARY SCHOOL</td>
<td>VI-001-17</td>
<td>780003000026</td>
<td>Not applicable</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">102127</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>YVONNE BOWSKY ELEMENTARY SCHOOL</td>
<td>VI-001-23</td>
<td>780003000027</td>
<td>Not applicable</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">102128</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>CANCRYN JUNIOR HIGH SCHOOL</td>
<td>VI-001-25</td>
<td>780003000033</td>
<td>Not applicable</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">102129</td>
<td>2021-2022</td>
<td>U.S. VIRGIN ISLANDS</td>
<td>VI</td>
<td>BERTHA BOSCHULTE JUNIOR HIGH</td>
<td>VI-001-9</td>
<td>780003000034</td>
<td>Not applicable</td>
</tr>
</tbody>
</table>

<p>102130 rows × 7 columns</p>
</div>
</div>
</div>
<p>One thing to note is that the directory dataset has 102,130 rows and the enrollment dataset has 100,029 rows. So there is a difference of 2,101 rows between them. When we join them we should expect our returned data to be within those ranges if we join accurately and depending on the type of join used.</p>
<p>For more info on the types of joins check out <a href="https://dataschool.com/how-to-teach-people-sql/sql-join-types-explained-visually/">this great tutorial from dataschool</a>.</p>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="st">    e.school_year,</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="st">    e.statename,</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="st">    e.st,</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="st">    e.sch_name,</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="st">    e.st_schid,</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="st">    e.ncessch,</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="st">    cast(e.student_count as int) as student_count,</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="st">    d.charter_text</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="st">  from directory_info d</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="st">  inner join total_enrollment e</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="st">    on d.school_year = e.school_year</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="st">    and d.st = e.st</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="st">    and d.ncessch = e.ncessch</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>enrollments_with_info <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>enrollments_with_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">st</th>
<th data-quarto-table-cell-role="th">sch_name</th>
<th data-quarto-table-cell-role="th">st_schid</th>
<th data-quarto-table-cell-role="th">ncessch</th>
<th data-quarto-table-cell-role="th">student_count</th>
<th data-quarto-table-cell-role="th">charter_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville High School</td>
<td>AL-101-0020</td>
<td>010000500871</td>
<td>1665.0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Intermediate School</td>
<td>AL-101-0110</td>
<td>010000500879</td>
<td>924.0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Elementary School</td>
<td>AL-101-0200</td>
<td>010000500889</td>
<td>891.0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Kindergarten and PreK</td>
<td>AL-101-0035</td>
<td>010000501616</td>
<td>579.0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>AL</td>
<td>Albertville Primary School</td>
<td>AL-101-0005</td>
<td>010000502150</td>
<td>977.0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100024</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>PR</td>
<td>ALEJANDRO JR CRUZ (GALATEO PARCELAS)</td>
<td>PR-01-71449</td>
<td>720003002078</td>
<td>129.0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100025</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>PR</td>
<td>BERWIND SUPERIOR</td>
<td>PR-01-67942</td>
<td>720003001333</td>
<td>228.0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100026</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>PR</td>
<td>DR. ANTONIO S. PEDREIRA (ESPECIALIZADA)</td>
<td>PR-01-61333</td>
<td>720003001370</td>
<td>299.0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100027</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>PR</td>
<td>TRINA PADILLA DE SANZ</td>
<td>PR-01-61440</td>
<td>720003001379</td>
<td>425.0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100028</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>PR</td>
<td>JUDITH A VIVAS</td>
<td>PR-01-16220</td>
<td>720003001971</td>
<td>247.0</td>
<td>No</td>
</tr>
</tbody>
</table>

<p>100029 rows × 8 columns</p>
</div>
</div>
</div>
<p>The <code>inner join</code> is something like the intersection of a venn diagram. It will return records (based on a matching condition or set of conditions) that appear in both datasets. Whereas a <code>left join</code> would return all the records in the first dataset along with <code>null</code> values for any records that don’t appear in the set that is being joined. This can be very useful when trying to determine which records are missing. For our purposes, we only only care about schools with actual enrollment (since we can’t calculate non-existing numbers of students).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> directory_info d</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span> total_enrollment e</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">on</span> d.school_year <span class="op">=</span> e.school_year</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> d.st <span class="op">=</span> e.st</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> d.ncessch <span class="op">=</span> e.ncessch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice the use of table aliases (<code>d</code> and <code>e</code> resprectively) to help distinguish between columns in either dataset. Another way to write that join without the aliases would be:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> directory_info</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span> total_enrollment</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">on</span> directory_info.school_year <span class="op">=</span> total_enrollment.school_year</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> directory_info.st <span class="op">=</span> total_enrollment.st</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> directory_info.ncessch <span class="op">=</span> total_enrollment.ncessch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For smaller table names this can be fine, but it does get tedious over time and sensible aliases can make the syntax of queries easier to read.</p>
<p>Table aliases and explicit table references are technically only required when the columns share names across both datasets (since the SQL interpreter can’t distinguish which one you mean) but it is generally considered a best practice when using joins to always specify the table source (preferably with an alias) in both the join conditions as well as in the <code>select</code> statement.</p>
<p>Because both of our original dataset are constrained by year, we could probably remove some of the join conditions.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> directory_info d</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span> total_enrollment e</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">on</span> d.st <span class="op">=</span> e.st</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> d.ncessch <span class="op">=</span> e.ncessch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And if we are certain the NCES IDs are unique across states (they are), we could further simplify as:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> directory_info d</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span> total_enrollment e</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">on</span> d.ncessch <span class="op">=</span> e.ncessch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="calculating-of-students-in-charters" class="level2">
<h2 class="anchored" data-anchor-id="calculating-of-students-in-charters">Calculating % of students in charters</h2>
<p>Now that we’ve combined our datasets, we can write our aggregations similar to what we did for schools earlier. We could do this using CTEs or since we’ve stored the joined data in an output variable (as a dataframe) we can query that directly.</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">    school_year,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">    statename,</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st">    count(if(charter_text = 'Yes', sch_name, null)) as charter_schools,</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">    count(sch_name) as total_schools,</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="st">    round((count(if(charter_text = 'Yes', sch_name, null))/count(sch_name)) * 100, 1) as percent_charter_schools,</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="st">    cast(sum(if(charter_text = 'Yes', student_count, 0)) as int) as charter_students,</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="st">    cast(sum(student_count) as int) as total_students,</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="st">    round((sum(if(charter_text = 'Yes', student_count, 0))/sum(student_count)) * 100, 1) as percent_charter_students,</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="st">  from enrollments_with_info </span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="st">  group by </span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="st">    school_year,</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="st">    statename</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="st">  having sum(student_count) is not null</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="st">    and sum(if(charter_text = 'Yes', student_count, 0)) &gt; 0</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="st">  order by percent_charter_students desc</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>charter_enrollments <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>charter_enrollments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">charter_schools</th>
<th data-quarto-table-cell-role="th">total_schools</th>
<th data-quarto-table-cell-role="th">percent_charter_schools</th>
<th data-quarto-table-cell-role="th">charter_students</th>
<th data-quarto-table-cell-role="th">total_students</th>
<th data-quarto-table-cell-role="th">percent_charter_students</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>DISTRICT OF COLUMBIA</td>
<td>123</td>
<td>240</td>
<td>51.2</td>
<td>39476</td>
<td>88543</td>
<td>44.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>ARIZONA</td>
<td>581</td>
<td>2418</td>
<td>24.0</td>
<td>231195</td>
<td>1131888</td>
<td>20.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>COLORADO</td>
<td>265</td>
<td>1941</td>
<td>13.7</td>
<td>130279</td>
<td>880582</td>
<td>14.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>NEVADA</td>
<td>93</td>
<td>746</td>
<td>12.5</td>
<td>63944</td>
<td>488251</td>
<td>13.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>FLORIDA</td>
<td>707</td>
<td>4191</td>
<td>16.9</td>
<td>361634</td>
<td>2832516</td>
<td>12.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2021-2022</td>
<td>LOUISIANA</td>
<td>146</td>
<td>1366</td>
<td>10.7</td>
<td>86301</td>
<td>680793</td>
<td>12.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2021-2022</td>
<td>DELAWARE</td>
<td>23</td>
<td>229</td>
<td>10.0</td>
<td>17201</td>
<td>139935</td>
<td>12.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2021-2022</td>
<td>CALIFORNIA</td>
<td>1291</td>
<td>10167</td>
<td>12.7</td>
<td>678056</td>
<td>5874619</td>
<td>11.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2021-2022</td>
<td>UTAH</td>
<td>137</td>
<td>1105</td>
<td>12.4</td>
<td>77733</td>
<td>687107</td>
<td>11.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2021-2022</td>
<td>MICHIGAN</td>
<td>374</td>
<td>3538</td>
<td>10.6</td>
<td>150327</td>
<td>1396598</td>
<td>10.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>2021-2022</td>
<td>PENNSYLVANIA</td>
<td>179</td>
<td>2941</td>
<td>6.1</td>
<td>163372</td>
<td>1671899</td>
<td>9.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2021-2022</td>
<td>NEW MEXICO</td>
<td>99</td>
<td>890</td>
<td>11.1</td>
<td>30160</td>
<td>316785</td>
<td>9.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2021-2022</td>
<td>IDAHO</td>
<td>77</td>
<td>784</td>
<td>9.8</td>
<td>28051</td>
<td>313909</td>
<td>8.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2021-2022</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1084</td>
<td>8.6</td>
<td>42341</td>
<td>489565</td>
<td>8.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2021-2022</td>
<td>NORTH CAROLINA</td>
<td>204</td>
<td>2719</td>
<td>7.5</td>
<td>131624</td>
<td>1525223</td>
<td>8.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2021-2022</td>
<td>OKLAHOMA</td>
<td>70</td>
<td>1792</td>
<td>3.9</td>
<td>59753</td>
<td>696411</td>
<td>8.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>2021-2022</td>
<td>RHODE ISLAND</td>
<td>40</td>
<td>315</td>
<td>12.7</td>
<td>11387</td>
<td>136864</td>
<td>8.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>2021-2022</td>
<td>TEXAS</td>
<td>1010</td>
<td>9105</td>
<td>11.1</td>
<td>443548</td>
<td>5428609</td>
<td>8.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>2021-2022</td>
<td>OREGON</td>
<td>131</td>
<td>1285</td>
<td>10.2</td>
<td>42668</td>
<td>540687</td>
<td>7.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>2021-2022</td>
<td>MINNESOTA</td>
<td>278</td>
<td>2661</td>
<td>10.4</td>
<td>66595</td>
<td>868742</td>
<td>7.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>2021-2022</td>
<td>HAWAII</td>
<td>37</td>
<td>294</td>
<td>12.6</td>
<td>12114</td>
<td>173178</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>2021-2022</td>
<td>NEW YORK</td>
<td>330</td>
<td>4802</td>
<td>6.9</td>
<td>173341</td>
<td>2526204</td>
<td>6.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>2021-2022</td>
<td>OHIO</td>
<td>324</td>
<td>3659</td>
<td>8.9</td>
<td>115021</td>
<td>1682397</td>
<td>6.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>2021-2022</td>
<td>SOUTH CAROLINA</td>
<td>88</td>
<td>1267</td>
<td>6.9</td>
<td>49344</td>
<td>780403</td>
<td>6.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>2021-2022</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8</td>
<td>1783</td>
<td>28402</td>
<td>6.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>2021-2022</td>
<td>WISCONSIN</td>
<td>236</td>
<td>2243</td>
<td>10.5</td>
<td>49715</td>
<td>827393</td>
<td>6.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>2021-2022</td>
<td>ALASKA</td>
<td>30</td>
<td>500</td>
<td>6.0</td>
<td>7621</td>
<td>129944</td>
<td>5.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>2021-2022</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1842</td>
<td>4.2</td>
<td>48399</td>
<td>911529</td>
<td>5.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>2021-2022</td>
<td>INDIANA</td>
<td>119</td>
<td>1915</td>
<td>6.2</td>
<td>50073</td>
<td>1033897</td>
<td>4.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>2021-2022</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2558</td>
<td>3.4</td>
<td>58780</td>
<td>1339937</td>
<td>4.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>2021-2022</td>
<td>TENNESSEE</td>
<td>116</td>
<td>1906</td>
<td>6.1</td>
<td>43908</td>
<td>995549</td>
<td>4.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>2021-2022</td>
<td>GEORGIA</td>
<td>94</td>
<td>2314</td>
<td>4.1</td>
<td>69242</td>
<td>1740875</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>2021-2022</td>
<td>ILLINOIS</td>
<td>136</td>
<td>4386</td>
<td>3.1</td>
<td>60496</td>
<td>1867412</td>
<td>3.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>2021-2022</td>
<td>NEW HAMPSHIRE</td>
<td>36</td>
<td>494</td>
<td>7.3</td>
<td>4934</td>
<td>168797</td>
<td>2.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>2021-2022</td>
<td>MARYLAND</td>
<td>48</td>
<td>1417</td>
<td>3.4</td>
<td>24104</td>
<td>881461</td>
<td>2.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>2021-2022</td>
<td>MISSOURI</td>
<td>78</td>
<td>2453</td>
<td>3.2</td>
<td>24146</td>
<td>887077</td>
<td>2.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>2021-2022</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1000</td>
<td>2.1</td>
<td>11047</td>
<td>496795</td>
<td>2.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>2021-2022</td>
<td>MAINE</td>
<td>13</td>
<td>571</td>
<td>2.3</td>
<td>2732</td>
<td>168236</td>
<td>1.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>2021-2022</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1040</td>
<td>0.7</td>
<td>2921</td>
<td>442000</td>
<td>0.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>2021-2022</td>
<td>WYOMING</td>
<td>5</td>
<td>359</td>
<td>1.4</td>
<td>642</td>
<td>92848</td>
<td>0.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>2021-2022</td>
<td>KANSAS</td>
<td>9</td>
<td>1355</td>
<td>0.7</td>
<td>2877</td>
<td>480069</td>
<td>0.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>843</td>
<td>0.8</td>
<td>1515</td>
<td>259535</td>
<td>0.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>11</td>
<td>1494</td>
<td>0.7</td>
<td>3566</td>
<td>747846</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>2021-2022</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2546</td>
<td>0.7</td>
<td>4571</td>
<td>1080143</td>
<td>0.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>2021-2022</td>
<td>VIRGINIA</td>
<td>7</td>
<td>1948</td>
<td>0.4</td>
<td>1278</td>
<td>1244624</td>
<td>0.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>2021-2022</td>
<td>IOWA</td>
<td>2</td>
<td>1325</td>
<td>0.2</td>
<td>149</td>
<td>503735</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You’ll notice some similar syntax as our previous aggregate query, but I have omitted the step converting the percent to a string here to aid in future analysis.</p>
</section>
<section id="wrapping-up-with-some-rankings" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up-with-some-rankings">Wrapping up with some rankings</h2>
<p>Now that we have the data we need for our investigation we can sort and re-sort the data and find answers to our inquiries, however one fundamental issue is coming up: the answer to our question is <em>it sort of depends …</em></p>
<p>Which is very common in data analysis. Depending on how you phrase your question you might get different answers. Wouldn’t it be nice to have a definitive answer about which state, broadly, ranks highest for charter presence?</p>
<p>To do this, let’s explore a little more advanced of a topic in SQL queries: <strong>window functions</strong>.</p>
<p>I won’t delve into them too deeply, but a basic understanding is helpful here:</p>
<blockquote class="blockquote">
<p>Imagine you’re looking at a row of data in a table, like a line of people. A window function in SQL helps you calculate things for each person in the line, like finding their position compared to others, without changing the order. It’s like having a magic window that lets you peek at everyone’s info while keeping them in the same order they were in. This helps you figure out things like who’s first, who’s last, and who’s in the middle without messing up the original line.</p>
</blockquote>
<p>In this case, we’d like to understand the ranking of each state for each calculation we created earlier. I.E. who is the #1 state for most charter schools and who is the #1 state for the most students in charter schools, etc. For thank we will use the <code>rank()</code> window function.</p>
<p>All window functions require an accompanying <code>over()</code> clause. They can get complicated but for our purposes we are just using them to specify the order to rank.</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select *,</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by percent_charter_schools desc) as percent_schools_rank,</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by charter_schools desc) as count_schools_rank,</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by percent_charter_students desc) as percent_students_rank,</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by charter_students desc) as count_students_rank,</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="st">  from charter_enrollments</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="st">  order by statename</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>rankings <span class="op">=</span> duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rankings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">charter_schools</th>
<th data-quarto-table-cell-role="th">total_schools</th>
<th data-quarto-table-cell-role="th">percent_charter_schools</th>
<th data-quarto-table-cell-role="th">charter_students</th>
<th data-quarto-table-cell-role="th">total_students</th>
<th data-quarto-table-cell-role="th">percent_charter_students</th>
<th data-quarto-table-cell-role="th">percent_schools_rank</th>
<th data-quarto-table-cell-role="th">count_schools_rank</th>
<th data-quarto-table-cell-role="th">percent_students_rank</th>
<th data-quarto-table-cell-role="th">count_students_rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>11</td>
<td>1494</td>
<td>0.7</td>
<td>3566</td>
<td>747846</td>
<td>0.5</td>
<td>41</td>
<td>39</td>
<td>43</td>
<td>38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>ALASKA</td>
<td>30</td>
<td>500</td>
<td>6.0</td>
<td>7621</td>
<td>129944</td>
<td>5.9</td>
<td>29</td>
<td>34</td>
<td>27</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>ARIZONA</td>
<td>581</td>
<td>2418</td>
<td>24.0</td>
<td>231195</td>
<td>1131888</td>
<td>20.4</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1084</td>
<td>8.6</td>
<td>42341</td>
<td>489565</td>
<td>8.6</td>
<td>20</td>
<td>22</td>
<td>14</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>CALIFORNIA</td>
<td>1291</td>
<td>10167</td>
<td>12.7</td>
<td>678056</td>
<td>5874619</td>
<td>11.5</td>
<td>5</td>
<td>1</td>
<td>8</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2021-2022</td>
<td>COLORADO</td>
<td>265</td>
<td>1941</td>
<td>13.7</td>
<td>130279</td>
<td>880582</td>
<td>14.8</td>
<td>4</td>
<td>9</td>
<td>3</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2021-2022</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1000</td>
<td>2.1</td>
<td>11047</td>
<td>496795</td>
<td>2.2</td>
<td>38</td>
<td>36</td>
<td>37</td>
<td>34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2021-2022</td>
<td>DELAWARE</td>
<td>23</td>
<td>229</td>
<td>10.0</td>
<td>17201</td>
<td>139935</td>
<td>12.3</td>
<td>17</td>
<td>35</td>
<td>7</td>
<td>31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2021-2022</td>
<td>DISTRICT OF COLUMBIA</td>
<td>123</td>
<td>240</td>
<td>51.2</td>
<td>39476</td>
<td>88543</td>
<td>44.6</td>
<td>1</td>
<td>17</td>
<td>1</td>
<td>26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2021-2022</td>
<td>FLORIDA</td>
<td>707</td>
<td>4191</td>
<td>16.9</td>
<td>361634</td>
<td>2832516</td>
<td>12.8</td>
<td>3</td>
<td>3</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>2021-2022</td>
<td>GEORGIA</td>
<td>94</td>
<td>2314</td>
<td>4.1</td>
<td>69242</td>
<td>1740875</td>
<td>4.0</td>
<td>31</td>
<td>21</td>
<td>32</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2021-2022</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8</td>
<td>1783</td>
<td>28402</td>
<td>6.3</td>
<td>25</td>
<td>45</td>
<td>24</td>
<td>42</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2021-2022</td>
<td>HAWAII</td>
<td>37</td>
<td>294</td>
<td>12.6</td>
<td>12114</td>
<td>173178</td>
<td>7.0</td>
<td>7</td>
<td>32</td>
<td>21</td>
<td>32</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2021-2022</td>
<td>IDAHO</td>
<td>77</td>
<td>784</td>
<td>9.8</td>
<td>28051</td>
<td>313909</td>
<td>8.9</td>
<td>18</td>
<td>28</td>
<td>13</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2021-2022</td>
<td>ILLINOIS</td>
<td>136</td>
<td>4386</td>
<td>3.1</td>
<td>60496</td>
<td>1867412</td>
<td>3.2</td>
<td>36</td>
<td>15</td>
<td>33</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2021-2022</td>
<td>INDIANA</td>
<td>119</td>
<td>1915</td>
<td>6.2</td>
<td>50073</td>
<td>1033897</td>
<td>4.8</td>
<td>26</td>
<td>18</td>
<td>29</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>2021-2022</td>
<td>IOWA</td>
<td>2</td>
<td>1325</td>
<td>0.2</td>
<td>149</td>
<td>503735</td>
<td>0.0</td>
<td>46</td>
<td>46</td>
<td>46</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>2021-2022</td>
<td>KANSAS</td>
<td>9</td>
<td>1355</td>
<td>0.7</td>
<td>2877</td>
<td>480069</td>
<td>0.6</td>
<td>41</td>
<td>40</td>
<td>41</td>
<td>40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>2021-2022</td>
<td>LOUISIANA</td>
<td>146</td>
<td>1366</td>
<td>10.7</td>
<td>86301</td>
<td>680793</td>
<td>12.7</td>
<td>12</td>
<td>13</td>
<td>6</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>2021-2022</td>
<td>MAINE</td>
<td>13</td>
<td>571</td>
<td>2.3</td>
<td>2732</td>
<td>168236</td>
<td>1.6</td>
<td>37</td>
<td>38</td>
<td>38</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>2021-2022</td>
<td>MARYLAND</td>
<td>48</td>
<td>1417</td>
<td>3.4</td>
<td>24104</td>
<td>881461</td>
<td>2.7</td>
<td>33</td>
<td>30</td>
<td>35</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>2021-2022</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1842</td>
<td>4.2</td>
<td>48399</td>
<td>911529</td>
<td>5.3</td>
<td>30</td>
<td>26</td>
<td>28</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>2021-2022</td>
<td>MICHIGAN</td>
<td>374</td>
<td>3538</td>
<td>10.6</td>
<td>150327</td>
<td>1396598</td>
<td>10.8</td>
<td>13</td>
<td>5</td>
<td>10</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>2021-2022</td>
<td>MINNESOTA</td>
<td>278</td>
<td>2661</td>
<td>10.4</td>
<td>66595</td>
<td>868742</td>
<td>7.7</td>
<td>15</td>
<td>8</td>
<td>20</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>2021-2022</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1040</td>
<td>0.7</td>
<td>2921</td>
<td>442000</td>
<td>0.7</td>
<td>41</td>
<td>41</td>
<td>39</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>2021-2022</td>
<td>MISSOURI</td>
<td>78</td>
<td>2453</td>
<td>3.2</td>
<td>24146</td>
<td>887077</td>
<td>2.7</td>
<td>35</td>
<td>26</td>
<td>35</td>
<td>29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>2021-2022</td>
<td>NEVADA</td>
<td>93</td>
<td>746</td>
<td>12.5</td>
<td>63944</td>
<td>488251</td>
<td>13.1</td>
<td>8</td>
<td>22</td>
<td>4</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>2021-2022</td>
<td>NEW HAMPSHIRE</td>
<td>36</td>
<td>494</td>
<td>7.3</td>
<td>4934</td>
<td>168797</td>
<td>2.9</td>
<td>22</td>
<td>33</td>
<td>34</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>2021-2022</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2558</td>
<td>3.4</td>
<td>58780</td>
<td>1339937</td>
<td>4.4</td>
<td>33</td>
<td>25</td>
<td>30</td>
<td>18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>2021-2022</td>
<td>NEW MEXICO</td>
<td>99</td>
<td>890</td>
<td>11.1</td>
<td>30160</td>
<td>316785</td>
<td>9.5</td>
<td>10</td>
<td>20</td>
<td>12</td>
<td>27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>2021-2022</td>
<td>NEW YORK</td>
<td>330</td>
<td>4802</td>
<td>6.9</td>
<td>173341</td>
<td>2526204</td>
<td>6.9</td>
<td>23</td>
<td>6</td>
<td>22</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>2021-2022</td>
<td>NORTH CAROLINA</td>
<td>204</td>
<td>2719</td>
<td>7.5</td>
<td>131624</td>
<td>1525223</td>
<td>8.6</td>
<td>21</td>
<td>11</td>
<td>14</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>2021-2022</td>
<td>OHIO</td>
<td>324</td>
<td>3659</td>
<td>8.9</td>
<td>115021</td>
<td>1682397</td>
<td>6.8</td>
<td>19</td>
<td>7</td>
<td>23</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>2021-2022</td>
<td>OKLAHOMA</td>
<td>70</td>
<td>1792</td>
<td>3.9</td>
<td>59753</td>
<td>696411</td>
<td>8.6</td>
<td>32</td>
<td>29</td>
<td>14</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>2021-2022</td>
<td>OREGON</td>
<td>131</td>
<td>1285</td>
<td>10.2</td>
<td>42668</td>
<td>540687</td>
<td>7.9</td>
<td>16</td>
<td>16</td>
<td>19</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>2021-2022</td>
<td>PENNSYLVANIA</td>
<td>179</td>
<td>2941</td>
<td>6.1</td>
<td>163372</td>
<td>1671899</td>
<td>9.8</td>
<td>27</td>
<td>12</td>
<td>11</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>843</td>
<td>0.8</td>
<td>1515</td>
<td>259535</td>
<td>0.6</td>
<td>40</td>
<td>41</td>
<td>41</td>
<td>43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>2021-2022</td>
<td>RHODE ISLAND</td>
<td>40</td>
<td>315</td>
<td>12.7</td>
<td>11387</td>
<td>136864</td>
<td>8.3</td>
<td>5</td>
<td>31</td>
<td>17</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>2021-2022</td>
<td>SOUTH CAROLINA</td>
<td>88</td>
<td>1267</td>
<td>6.9</td>
<td>49344</td>
<td>780403</td>
<td>6.3</td>
<td>23</td>
<td>24</td>
<td>24</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>2021-2022</td>
<td>TENNESSEE</td>
<td>116</td>
<td>1906</td>
<td>6.1</td>
<td>43908</td>
<td>995549</td>
<td>4.4</td>
<td>27</td>
<td>19</td>
<td>30</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>2021-2022</td>
<td>TEXAS</td>
<td>1010</td>
<td>9105</td>
<td>11.1</td>
<td>443548</td>
<td>5428609</td>
<td>8.2</td>
<td>10</td>
<td>2</td>
<td>18</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>2021-2022</td>
<td>UTAH</td>
<td>137</td>
<td>1105</td>
<td>12.4</td>
<td>77733</td>
<td>687107</td>
<td>11.3</td>
<td>9</td>
<td>14</td>
<td>9</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>2021-2022</td>
<td>VIRGINIA</td>
<td>7</td>
<td>1948</td>
<td>0.4</td>
<td>1278</td>
<td>1244624</td>
<td>0.1</td>
<td>45</td>
<td>41</td>
<td>45</td>
<td>44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>2021-2022</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2546</td>
<td>0.7</td>
<td>4571</td>
<td>1080143</td>
<td>0.4</td>
<td>41</td>
<td>37</td>
<td>44</td>
<td>37</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>2021-2022</td>
<td>WISCONSIN</td>
<td>236</td>
<td>2243</td>
<td>10.5</td>
<td>49715</td>
<td>827393</td>
<td>6.0</td>
<td>14</td>
<td>10</td>
<td>26</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>2021-2022</td>
<td>WYOMING</td>
<td>5</td>
<td>359</td>
<td>1.4</td>
<td>642</td>
<td>92848</td>
<td>0.7</td>
<td>39</td>
<td>44</td>
<td>39</td>
<td>45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="combining-rankings" class="level3">
<h3 class="anchored" data-anchor-id="combining-rankings">Combining Rankings</h3>
<p>These rankings are useful and can certainly make it easier to sort, but they haven’t provided us with any more definitive of an answer. To do that, let’s combine the rankings across metrics and find which state has the lowest value (ie. closest to #1 across all combined metrics).</p>
<p>We’ll once again use the <code>rank</code> function but across the sum of the other ranks.</p>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select *,</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by (percent_schools_rank + count_schools_rank + percent_students_rank + count_students_rank)) as combined_ranking</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">  from rankings</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="st">  order by combined_ranking</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>duckdb.sql(query).df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_year</th>
<th data-quarto-table-cell-role="th">statename</th>
<th data-quarto-table-cell-role="th">charter_schools</th>
<th data-quarto-table-cell-role="th">total_schools</th>
<th data-quarto-table-cell-role="th">percent_charter_schools</th>
<th data-quarto-table-cell-role="th">charter_students</th>
<th data-quarto-table-cell-role="th">total_students</th>
<th data-quarto-table-cell-role="th">percent_charter_students</th>
<th data-quarto-table-cell-role="th">percent_schools_rank</th>
<th data-quarto-table-cell-role="th">count_schools_rank</th>
<th data-quarto-table-cell-role="th">percent_students_rank</th>
<th data-quarto-table-cell-role="th">count_students_rank</th>
<th data-quarto-table-cell-role="th">combined_ranking</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-2022</td>
<td>ARIZONA</td>
<td>581</td>
<td>2418</td>
<td>24.0</td>
<td>231195</td>
<td>1131888</td>
<td>20.4</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-2022</td>
<td>FLORIDA</td>
<td>707</td>
<td>4191</td>
<td>16.9</td>
<td>361634</td>
<td>2832516</td>
<td>12.8</td>
<td>3</td>
<td>3</td>
<td>5</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-2022</td>
<td>CALIFORNIA</td>
<td>1291</td>
<td>10167</td>
<td>12.7</td>
<td>678056</td>
<td>5874619</td>
<td>11.5</td>
<td>5</td>
<td>1</td>
<td>8</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-2022</td>
<td>COLORADO</td>
<td>265</td>
<td>1941</td>
<td>13.7</td>
<td>130279</td>
<td>880582</td>
<td>14.8</td>
<td>4</td>
<td>9</td>
<td>3</td>
<td>9</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-2022</td>
<td>TEXAS</td>
<td>1010</td>
<td>9105</td>
<td>11.1</td>
<td>443548</td>
<td>5428609</td>
<td>8.2</td>
<td>10</td>
<td>2</td>
<td>18</td>
<td>2</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2021-2022</td>
<td>MICHIGAN</td>
<td>374</td>
<td>3538</td>
<td>10.6</td>
<td>150327</td>
<td>1396598</td>
<td>10.8</td>
<td>13</td>
<td>5</td>
<td>10</td>
<td>7</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2021-2022</td>
<td>LOUISIANA</td>
<td>146</td>
<td>1366</td>
<td>10.7</td>
<td>86301</td>
<td>680793</td>
<td>12.7</td>
<td>12</td>
<td>13</td>
<td>6</td>
<td>11</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2021-2022</td>
<td>UTAH</td>
<td>137</td>
<td>1105</td>
<td>12.4</td>
<td>77733</td>
<td>687107</td>
<td>11.3</td>
<td>9</td>
<td>14</td>
<td>9</td>
<td>12</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2021-2022</td>
<td>DISTRICT OF COLUMBIA</td>
<td>123</td>
<td>240</td>
<td>51.2</td>
<td>39476</td>
<td>88543</td>
<td>44.6</td>
<td>1</td>
<td>17</td>
<td>1</td>
<td>26</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2021-2022</td>
<td>NEVADA</td>
<td>93</td>
<td>746</td>
<td>12.5</td>
<td>63944</td>
<td>488251</td>
<td>13.1</td>
<td>8</td>
<td>22</td>
<td>4</td>
<td>15</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>2021-2022</td>
<td>NORTH CAROLINA</td>
<td>204</td>
<td>2719</td>
<td>7.5</td>
<td>131624</td>
<td>1525223</td>
<td>8.6</td>
<td>21</td>
<td>11</td>
<td>14</td>
<td>8</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2021-2022</td>
<td>NEW YORK</td>
<td>330</td>
<td>4802</td>
<td>6.9</td>
<td>173341</td>
<td>2526204</td>
<td>6.9</td>
<td>23</td>
<td>6</td>
<td>22</td>
<td>5</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2021-2022</td>
<td>PENNSYLVANIA</td>
<td>179</td>
<td>2941</td>
<td>6.1</td>
<td>163372</td>
<td>1671899</td>
<td>9.8</td>
<td>27</td>
<td>12</td>
<td>11</td>
<td>6</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2021-2022</td>
<td>MINNESOTA</td>
<td>278</td>
<td>2661</td>
<td>10.4</td>
<td>66595</td>
<td>868742</td>
<td>7.7</td>
<td>15</td>
<td>8</td>
<td>20</td>
<td>14</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2021-2022</td>
<td>OHIO</td>
<td>324</td>
<td>3659</td>
<td>8.9</td>
<td>115021</td>
<td>1682397</td>
<td>6.8</td>
<td>19</td>
<td>7</td>
<td>23</td>
<td>10</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2021-2022</td>
<td>NEW MEXICO</td>
<td>99</td>
<td>890</td>
<td>11.1</td>
<td>30160</td>
<td>316785</td>
<td>9.5</td>
<td>10</td>
<td>20</td>
<td>12</td>
<td>27</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>2021-2022</td>
<td>WISCONSIN</td>
<td>236</td>
<td>2243</td>
<td>10.5</td>
<td>49715</td>
<td>827393</td>
<td>6.0</td>
<td>14</td>
<td>10</td>
<td>26</td>
<td>20</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>2021-2022</td>
<td>OREGON</td>
<td>131</td>
<td>1285</td>
<td>10.2</td>
<td>42668</td>
<td>540687</td>
<td>7.9</td>
<td>16</td>
<td>16</td>
<td>19</td>
<td>24</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>2021-2022</td>
<td>ARKANSAS</td>
<td>93</td>
<td>1084</td>
<td>8.6</td>
<td>42341</td>
<td>489565</td>
<td>8.6</td>
<td>20</td>
<td>22</td>
<td>14</td>
<td>25</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>2021-2022</td>
<td>RHODE ISLAND</td>
<td>40</td>
<td>315</td>
<td>12.7</td>
<td>11387</td>
<td>136864</td>
<td>8.3</td>
<td>5</td>
<td>31</td>
<td>17</td>
<td>33</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>2021-2022</td>
<td>IDAHO</td>
<td>77</td>
<td>784</td>
<td>9.8</td>
<td>28051</td>
<td>313909</td>
<td>8.9</td>
<td>18</td>
<td>28</td>
<td>13</td>
<td>28</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>2021-2022</td>
<td>DELAWARE</td>
<td>23</td>
<td>229</td>
<td>10.0</td>
<td>17201</td>
<td>139935</td>
<td>12.3</td>
<td>17</td>
<td>35</td>
<td>7</td>
<td>31</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>2021-2022</td>
<td>HAWAII</td>
<td>37</td>
<td>294</td>
<td>12.6</td>
<td>12114</td>
<td>173178</td>
<td>7.0</td>
<td>7</td>
<td>32</td>
<td>21</td>
<td>32</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>2021-2022</td>
<td>INDIANA</td>
<td>119</td>
<td>1915</td>
<td>6.2</td>
<td>50073</td>
<td>1033897</td>
<td>4.8</td>
<td>26</td>
<td>18</td>
<td>29</td>
<td>19</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>2021-2022</td>
<td>OKLAHOMA</td>
<td>70</td>
<td>1792</td>
<td>3.9</td>
<td>59753</td>
<td>696411</td>
<td>8.6</td>
<td>32</td>
<td>29</td>
<td>14</td>
<td>17</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>2021-2022</td>
<td>SOUTH CAROLINA</td>
<td>88</td>
<td>1267</td>
<td>6.9</td>
<td>49344</td>
<td>780403</td>
<td>6.3</td>
<td>23</td>
<td>24</td>
<td>24</td>
<td>21</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>2021-2022</td>
<td>GEORGIA</td>
<td>94</td>
<td>2314</td>
<td>4.1</td>
<td>69242</td>
<td>1740875</td>
<td>4.0</td>
<td>31</td>
<td>21</td>
<td>32</td>
<td>13</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>2021-2022</td>
<td>TENNESSEE</td>
<td>116</td>
<td>1906</td>
<td>6.1</td>
<td>43908</td>
<td>995549</td>
<td>4.4</td>
<td>27</td>
<td>19</td>
<td>30</td>
<td>23</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>2021-2022</td>
<td>ILLINOIS</td>
<td>136</td>
<td>4386</td>
<td>3.1</td>
<td>60496</td>
<td>1867412</td>
<td>3.2</td>
<td>36</td>
<td>15</td>
<td>33</td>
<td>16</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>2021-2022</td>
<td>MASSACHUSETTS</td>
<td>78</td>
<td>1842</td>
<td>4.2</td>
<td>48399</td>
<td>911529</td>
<td>5.3</td>
<td>30</td>
<td>26</td>
<td>28</td>
<td>22</td>
<td>30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>2021-2022</td>
<td>NEW JERSEY</td>
<td>87</td>
<td>2558</td>
<td>3.4</td>
<td>58780</td>
<td>1339937</td>
<td>4.4</td>
<td>33</td>
<td>25</td>
<td>30</td>
<td>18</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>2021-2022</td>
<td>ALASKA</td>
<td>30</td>
<td>500</td>
<td>6.0</td>
<td>7621</td>
<td>129944</td>
<td>5.9</td>
<td>29</td>
<td>34</td>
<td>27</td>
<td>35</td>
<td>32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>2021-2022</td>
<td>MISSOURI</td>
<td>78</td>
<td>2453</td>
<td>3.2</td>
<td>24146</td>
<td>887077</td>
<td>2.7</td>
<td>35</td>
<td>26</td>
<td>35</td>
<td>29</td>
<td>32</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>2021-2022</td>
<td>NEW HAMPSHIRE</td>
<td>36</td>
<td>494</td>
<td>7.3</td>
<td>4934</td>
<td>168797</td>
<td>2.9</td>
<td>22</td>
<td>33</td>
<td>34</td>
<td>36</td>
<td>32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>2021-2022</td>
<td>MARYLAND</td>
<td>48</td>
<td>1417</td>
<td>3.4</td>
<td>24104</td>
<td>881461</td>
<td>2.7</td>
<td>33</td>
<td>30</td>
<td>35</td>
<td>30</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>2021-2022</td>
<td>GUAM</td>
<td>3</td>
<td>44</td>
<td>6.8</td>
<td>1783</td>
<td>28402</td>
<td>6.3</td>
<td>25</td>
<td>45</td>
<td>24</td>
<td>42</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>2021-2022</td>
<td>CONNECTICUT</td>
<td>21</td>
<td>1000</td>
<td>2.1</td>
<td>11047</td>
<td>496795</td>
<td>2.2</td>
<td>38</td>
<td>36</td>
<td>37</td>
<td>34</td>
<td>37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>2021-2022</td>
<td>MAINE</td>
<td>13</td>
<td>571</td>
<td>2.3</td>
<td>2732</td>
<td>168236</td>
<td>1.6</td>
<td>37</td>
<td>38</td>
<td>38</td>
<td>41</td>
<td>38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>2021-2022</td>
<td>WASHINGTON</td>
<td>17</td>
<td>2546</td>
<td>0.7</td>
<td>4571</td>
<td>1080143</td>
<td>0.4</td>
<td>41</td>
<td>37</td>
<td>44</td>
<td>37</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>2021-2022</td>
<td>MISSISSIPPI</td>
<td>7</td>
<td>1040</td>
<td>0.7</td>
<td>2921</td>
<td>442000</td>
<td>0.7</td>
<td>41</td>
<td>41</td>
<td>39</td>
<td>39</td>
<td>40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>2021-2022</td>
<td>ALABAMA</td>
<td>11</td>
<td>1494</td>
<td>0.7</td>
<td>3566</td>
<td>747846</td>
<td>0.5</td>
<td>41</td>
<td>39</td>
<td>43</td>
<td>38</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>2021-2022</td>
<td>KANSAS</td>
<td>9</td>
<td>1355</td>
<td>0.7</td>
<td>2877</td>
<td>480069</td>
<td>0.6</td>
<td>41</td>
<td>40</td>
<td>41</td>
<td>40</td>
<td>42</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>2021-2022</td>
<td>PUERTO RICO</td>
<td>7</td>
<td>843</td>
<td>0.8</td>
<td>1515</td>
<td>259535</td>
<td>0.6</td>
<td>40</td>
<td>41</td>
<td>41</td>
<td>43</td>
<td>43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>2021-2022</td>
<td>WYOMING</td>
<td>5</td>
<td>359</td>
<td>1.4</td>
<td>642</td>
<td>92848</td>
<td>0.7</td>
<td>39</td>
<td>44</td>
<td>39</td>
<td>45</td>
<td>44</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>2021-2022</td>
<td>VIRGINIA</td>
<td>7</td>
<td>1948</td>
<td>0.4</td>
<td>1278</td>
<td>1244624</td>
<td>0.1</td>
<td>45</td>
<td>41</td>
<td>45</td>
<td>44</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>2021-2022</td>
<td>IOWA</td>
<td>2</td>
<td>1325</td>
<td>0.2</td>
<td>149</td>
<td>503735</td>
<td>0.0</td>
<td>46</td>
<td>46</td>
<td>46</td>
<td>46</td>
<td>46</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We can see that Arizona ranks highest for charter presence, followed by Florida. A quite different story than we were getting previously with our one-off questions. Fascinating!</p>
<p>There is much more you can do as you expand your knowledge of sql; including taking this data and visualizing it for presentation to an audience. That’s a topic for another day but let’s store our results in a new dataset.</p>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="st">  select *,</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="st">    rank() over(order by (percent_schools_rank + count_schools_rank + percent_students_rank + count_students_rank)) as combined_ranking</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="st">  from rankings</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="st">  order by combined_ranking</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>charter_presence_rankings <span class="op">=</span> duckdb.sql(query).df()</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>charter_presence_rankings.to_csv(<span class="st">"charter_presence_rankings.csv.gz"</span>, compression<span class="op">=</span><span class="st">"gzip"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can <a href="../../posts/sql-basics-with-duckdb/charter_presence_rankings.csv.gz">download this data here</a> if you like.</p>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>In this tutorial we learned: 1. some basic SQL vocabulary 2. how to read data from files into dataframes for querying 3. how to explore the structure of a new dataset 4. how to select data from a dataframe using duckdb and sql syntax 5. how to filter and limit data 6. how to translate questions into queries 7. how to do some basic aggregations like <code>count</code> and <code>sum</code> 8. how to better organize complex queries with CTEs 9. a valuable lesson about data types 10. how to join data from multiple datasets 11. how to leverage a basic window function <code>rank</code> to come to a more definitive answer 12. how to store the output of our analysis for future use</p>
<p>I hope this was helpful and gave you a taste of how to iterate on a set of questions using SQL to find an answer in a structured way (even without access to a database).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>