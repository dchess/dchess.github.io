
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/monokai.min.css">


  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">

    <link href="./static/custom.css" rel="stylesheet">

    <link href="http://dchess.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="dchess Atom">


    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">



<meta name="author" content="dc.hess@gmail.com" />
<meta name="description" content="An explanation about using the pandas json_normalize function to handle nested JSON data." />
<meta name="keywords" content="">


<meta property="og:site_name" content="dchess"/>
<meta property="og:title" content="Normalize JSON with Pandas"/>
<meta property="og:description" content="An explanation about using the pandas json_normalize function to handle nested JSON data."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./normalize-json-with-pandas.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2021-01-12 21:00:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/dchessgmailcom.html">
<meta property="article:section" content="Tutorial"/>
<meta property="og:image" content="/images/profile.jpg">

  <title>dchess &ndash; Normalize JSON with Pandas</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href=".">
        <img src="/images/profile.jpg" alt="D.C. Hess" title="D.C. Hess">
      </a>

      <h1>
        <a href=".">D.C. Hess</a>
      </h1>

<p>Software Engineer</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="./pages/about-me.html#about-me">
                  About Me
                </a>
              </li>

            <li>
              <a target="_self" href="https://drive.google.com/file/d/1O0-Le26SdL-DhDo2LsOQVWR5BAV4I17F/view" >resume</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://www.github.com/dchess" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/dc_hess" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/dchess" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
          <li>
            <a  class="sc-envelope-o" href="mailto:dc.hess@gmail.com" target="_blank">
              <i class="fab fa-envelope-o"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href=".">Home</a>

      <a href="/category/projects.html">Projects</a>

      <a href="http://dchess.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="normalize-json-with-pandas">Normalize JSON with Pandas</h1>
    <p>
      Posted on Tue 12 January 2021 in <a href="./category/tutorial.html">Tutorial</a>

    </p>
  </header>


  <div>
    <div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When processing nested <code>JSON</code> data into a flat structure for importing into a relational database, it can be tricky to structure the data into the right shape. <a href="https://pandas.pydata.org/">Pandas</a> has a great tool for doing this called <code>pandas.json_normalize()</code> but the <a href="https://pandas.pydata.org/docs/reference/api/pandas.json_normalize.html?highlight=json_normalize">documentation</a> doesn't make it obvious how to leverage its capabilities for handling nested data structures.</p>
<p>I thought I could provide a brief example using some randomly generated survey response data (using the <a href="https://faker.readthedocs.io/en/master/">Faker</a> library) to illustrate it's advantages.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup">&#182;</a></h2><p>To start, I'm going to be using pandas and Faker so we'll import those. I'm also going to need to easily display the parsed json as well as the returned dataframes, so I'm importing the json module from the standard lib as well as some IPython notebook helpers for displaying dataframes as HTML tables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">faker.providers</span> <span class="kn">import</span> <span class="n">BaseProvider</span><span class="p">,</span> <span class="n">date_time</span><span class="p">,</span> <span class="n">internet</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To make it easier to call the IPython display helper, we'll include this simple function as <strong>syntactic sugar</strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fake-Data">Fake Data<a class="anchor-link" href="#Fake-Data">&#182;</a></h2><p>Faker doesn't have a built in provider for survey questions, so let's go ahead and add a simple one that creates non-sensical questions with a simple hack to the sentence provider.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MyProvider</span><span class="p">(</span><span class="n">BaseProvider</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stems</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Does&#39;</span><span class="p">,</span> <span class="s1">&#39;How does&#39;</span><span class="p">,</span> <span class="s1">&#39;Which&#39;</span><span class="p">,</span> <span class="s1">&#39;Why does&#39;</span><span class="p">)</span>
        <span class="n">stem</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span><span class="o">.</span><span class="n">random_choices</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">stems</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span><span class="o">.</span><span class="n">sentence</span><span class="p">()</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stem</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">question</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using this new question provider, we'll construct a few records of fake survey response data with some respondent level data like a respondent_id, survey_date, and respondent email. Within that we'll nest a list of responses which will in turn have it's own dictionary of data at the question level: id, question text, and choices. The choices list will be singular here, but assume it has that structure because the API this comes from has to also account for multi-select options and we'll need to parse it as a list regardless. <em>Depending on our analysis needs, this might also be a place where we'd want to keep these in a comma separated string, but for our purposes here we'll ignore that use case.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">fake</span><span class="o">.</span><span class="n">add_provider</span><span class="p">(</span><span class="n">MyProvider</span><span class="p">)</span>
<span class="n">choices</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Strongly Agree&#39;</span><span class="p">,</span> <span class="s1">&#39;Agree&#39;</span><span class="p">,</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Disagree&#39;</span><span class="p">,</span> <span class="s1">&#39;Strongly Disagree&#39;</span><span class="p">)</span>


<span class="n">sample_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">bothify</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;#?##??###?#&quot;</span><span class="p">),</span>
        <span class="s2">&quot;survey_date&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">email</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;example.com&quot;</span><span class="p">),</span>
        <span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;question_id&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">bothify</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;#??#??###?#&quot;</span><span class="p">),</span>
                <span class="s2">&quot;question_text&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">question</span><span class="p">(),</span>
                <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;choice&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_choices</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_digit</span><span class="p">(),</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's print out a single record to see the resulting data structure that has been generated randomly.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sample_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  &#34;respondent_id&#34;: &#34;9U69hZ538l1&#34;,
  &#34;survey_date&#34;: &#34;1994-03-20&#34;,
  &#34;email&#34;: &#34;lindsey24@example.com&#34;,
  &#34;responses&#34;: [
    {
      &#34;question_id&#34;: &#34;7YB4ZO864I7&#34;,
      &#34;question_text&#34;: &#34;How does speak beat ever tree?&#34;,
      &#34;choices&#34;: [
        {
          &#34;choice&#34;: &#34;Strongly Agree&#34;,
          &#34;number&#34;: 4
        }
      ]
    },
    {
      &#34;question_id&#34;: &#34;8uD0WY155Q9&#34;,
      &#34;question_text&#34;: &#34;How does write popular Mr know develop?&#34;,
      &#34;choices&#34;: [
        {
          &#34;choice&#34;: &#34;Agree&#34;,
          &#34;number&#34;: 9
        }
      ]
    },
    {
      &#34;question_id&#34;: &#34;8bN0OP829A8&#34;,
      &#34;question_text&#34;: &#34;Why does democratic represent far my pressure series third?&#34;,
      &#34;choices&#34;: [
        {
          &#34;choice&#34;: &#34;Strongly Agree&#34;,
          &#34;number&#34;: 9
        }
      ]
    },
    {
      &#34;question_id&#34;: &#34;2Rt9mk140E8&#34;,
      &#34;question_text&#34;: &#34;How does understand network old?&#34;,
      &#34;choices&#34;: [
        {
          &#34;choice&#34;: &#34;Agree&#34;,
          &#34;number&#34;: 2
        }
      ]
    },
    {
      &#34;question_id&#34;: &#34;8tf2SU934m8&#34;,
      &#34;question_text&#34;: &#34;Why does western next put?&#34;,
      &#34;choices&#34;: [
        {
          &#34;choice&#34;: &#34;Neutral&#34;,
          &#34;number&#34;: 8
        }
      ]
    }
  ]
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading-with-Pandas">Reading with Pandas<a class="anchor-link" href="#Reading-with-Pandas">&#182;</a></h2><p>As you can see below, simply reading this directly into a dataframe only parses the top level respondent data, but then keeps the responses data as a json array. Which isn't great for simple analysis. Could you load that "as is" into a jsonb field in PostgreSQL? Sure. If you like parsing json with SQL. Yuck!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[68]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>responses</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>[{'question_id': '7YB4ZO864I7', 'question_text': 'How does speak beat ever tree?', 'choices': [{'choice': 'Strongly Agree', 'number': 4}]}, {'question_id': '8uD0WY155Q9', 'question_text': 'How does write popular Mr know develop?', 'choices': [{'choice': 'Agree', 'number': 9}]}, {'question_id': '8bN0OP829A8', 'question_text': 'Why does democratic represent far my pressure series third?', 'choices': [{'choice': 'Strongly Agree', 'number': 9}]}, {'question_id': '2Rt9mk140E8', 'question_text': 'How does understand network old?', 'choices': [{'choice': 'Agree', 'number': 2}]}, {'question_id': '8tf2SU934m8', 'question_text': 'Why does western next put?', 'choices': [{'choice': 'Neutral', 'number': 8}]}]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>[{'question_id': '2CP2AW568v2', 'question_text': 'Why does whatever play office move alone class part wish?', 'choices': [{'choice': 'Neutral', 'number': 0}]}, {'question_id': '2YV7SR528f0', 'question_text': 'Why does which phone return much door?', 'choices': [{'choice': 'Disagree', 'number': 7}]}, {'question_id': '3PJ8eR903v4', 'question_text': 'Why does despite be class various great stay Republican person?', 'choices': [{'choice': 'Neutral', 'number': 4}]}, {'question_id': '2GV2kH553o3', 'question_text': 'Does become create store store?', 'choices': [{'choice': 'Disagree', 'number': 8}]}, {'question_id': '9aX3NJ910f8', 'question_text': 'Which team life although rate science I pattern?', 'choices': [{'choice': 'Strongly Disagree', 'number': 7}]}]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A-messy-custom-parser">A messy custom parser<a class="anchor-link" href="#A-messy-custom-parser">&#182;</a></h2><p>We could attempt to reshape this by writing some custom functions to handle extracting the responses and merging that data with the top-level meta data about the respondent with some dictionary unpacking, but this gets messy and would fall apart quickly as the structure changed. While this approach works, it's not ideal.</p>
<p>Sure this code could be further refactored to simplify the logic, but it's not worth it since the <code>pandas.json_normalize()</code> can do this for us easily.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[69]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">record_format</span><span class="p">(</span><span class="n">responses</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;question_id&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;question_id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;question_text&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;question_text&quot;</span><span class="p">),</span>
            <span class="s2">&quot;choice&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choice&quot;</span><span class="p">),</span>
            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">parse_json</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">sample_data</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;respondent_id&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;respondent_id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;survey_date&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;survey_date&quot;</span><span class="p">),</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;responses&quot;</span><span class="p">)</span>
        <span class="n">formatted_responses</span> <span class="o">=</span> <span class="n">record_format</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">formatted_responses</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">response</span><span class="p">}</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="n">clean_data</span> <span class="o">=</span> <span class="n">parse_json</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clean_data</span><span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>question_id</th>
      <th>question_text</th>
      <th>choice</th>
      <th>number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
      <td>Strongly Agree</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
      <td>Agree</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
      <td>Strongly Agree</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
      <td>Agree</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
      <td>Neutral</td>
      <td>8</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
      <td>Neutral</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
      <td>Disagree</td>
      <td>7</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
      <td>Neutral</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
      <td>Disagree</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
      <td>Strongly Disagree</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="JSON-Normalize">JSON Normalize<a class="anchor-link" href="#JSON-Normalize">&#182;</a></h2><p>Thankfully there is the <code>json_normalize()</code> function, but it requires a little understanding to get it to satisfactorily parse flat. Simply passing it the sample data without any parameters results in a very familiar result that gets us no further than we started in the first attempt.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>responses</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>[{'question_id': '7YB4ZO864I7', 'question_text': 'How does speak beat ever tree?', 'choices': [{'choice': 'Strongly Agree', 'number': 4}]}, {'question_id': '8uD0WY155Q9', 'question_text': 'How does write popular Mr know develop?', 'choices': [{'choice': 'Agree', 'number': 9}]}, {'question_id': '8bN0OP829A8', 'question_text': 'Why does democratic represent far my pressure series third?', 'choices': [{'choice': 'Strongly Agree', 'number': 9}]}, {'question_id': '2Rt9mk140E8', 'question_text': 'How does understand network old?', 'choices': [{'choice': 'Agree', 'number': 2}]}, {'question_id': '8tf2SU934m8', 'question_text': 'Why does western next put?', 'choices': [{'choice': 'Neutral', 'number': 8}]}]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>[{'question_id': '2CP2AW568v2', 'question_text': 'Why does whatever play office move alone class part wish?', 'choices': [{'choice': 'Neutral', 'number': 0}]}, {'question_id': '2YV7SR528f0', 'question_text': 'Why does which phone return much door?', 'choices': [{'choice': 'Disagree', 'number': 7}]}, {'question_id': '3PJ8eR903v4', 'question_text': 'Why does despite be class various great stay Republican person?', 'choices': [{'choice': 'Neutral', 'number': 4}]}, {'question_id': '2GV2kH553o3', 'question_text': 'Does become create store store?', 'choices': [{'choice': 'Disagree', 'number': 8}]}, {'question_id': '9aX3NJ910f8', 'question_text': 'Which team life although rate science I pattern?', 'choices': [{'choice': 'Strongly Disagree', 'number': 7}]}]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A few optional parameters can be used here to parse the first nested array called <code>responses</code>. We can direct the pandas json parser to a specific key as the source of records. The <code>record_path</code> parameter takes either a string or list of strings to construct that path. The name of this parameter is a hint about how to think of this when passed as a list as we'll see later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[71]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">record_path</span><span class="o">=</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> 
<span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>question_id</th>
      <th>question_text</th>
      <th>choices</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
      <td>[{'choice': 'Strongly Agree', 'number': 4}]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
      <td>[{'choice': 'Agree', 'number': 9}]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
      <td>[{'choice': 'Strongly Agree', 'number': 9}]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
      <td>[{'choice': 'Agree', 'number': 2}]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
      <td>[{'choice': 'Neutral', 'number': 8}]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
      <td>[{'choice': 'Neutral', 'number': 0}]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
      <td>[{'choice': 'Disagree', 'number': 7}]</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
      <td>[{'choice': 'Neutral', 'number': 4}]</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
      <td>[{'choice': 'Disagree', 'number': 8}]</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
      <td>[{'choice': 'Strongly Disagree', 'number': 7}]</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But when we direct the parser to just unpack the <code>reponses</code> array, we lose our data from the level above. Pandas can be instructed to keep this by giving it a list of metadata to repeat for each record it unpacks from the level above. We use the <code>meta</code> parameter and pass it a list of the fields to include.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">record_path</span><span class="o">=</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> 
     <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span> 
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
   
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>question_id</th>
      <th>question_text</th>
      <th>choices</th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
      <td>[{'choice': 'Strongly Agree', 'number': 4}]</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
      <td>[{'choice': 'Agree', 'number': 9}]</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
      <td>[{'choice': 'Strongly Agree', 'number': 9}]</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
      <td>[{'choice': 'Agree', 'number': 2}]</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
      <td>[{'choice': 'Neutral', 'number': 8}]</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
      <td>[{'choice': 'Neutral', 'number': 0}]</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
      <td>[{'choice': 'Disagree', 'number': 7}]</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
      <td>[{'choice': 'Neutral', 'number': 4}]</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
      <td>[{'choice': 'Disagree', 'number': 8}]</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
      <td>[{'choice': 'Strongly Disagree', 'number': 7}]</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="We-must-go-deeper!">We must go deeper!<a class="anchor-link" href="#We-must-go-deeper!">&#182;</a></h2><p>That works for the most part, but we still have that annoying <strong>choices</strong> json array that would be nice to split out into columns.</p>
<div class="highlight"><pre><span></span><span class="n">df5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">record_path</span><span class="o">=</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> 
    <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span> 
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
<p>Simply passing the choices field to the <code>record_path</code> param results in a <code>KeyError</code> though. This is because the <strong>choices</strong> field is actually nested in the <strong>responses</strong> field. So pandas need us to construct a path to reach it. We can get to it by passing each key as a record in the list to construct a path. Here that looks like <code>["responses", "choices"]</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">],</span> 
    <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span> 
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>choice</th>
      <th>number</th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Strongly Agree</td>
      <td>4</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Strongly Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Agree</td>
      <td>2</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Neutral</td>
      <td>8</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
      <td>0</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Neutral</td>
      <td>4</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Disagree</td>
      <td>8</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Strongly Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But when we do that, we lose our <strong>question_id</strong> and <strong>question_text</strong> fields. That's because we need to add them in the meta list and pass their paths like the record path param. See below.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[74]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">],</span> 
    <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span> 
        <span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;question_id&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;question_text&quot;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>choice</th>
      <th>number</th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>responses.question_id</th>
      <th>responses.question_text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Strongly Agree</td>
      <td>4</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Strongly Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Agree</td>
      <td>2</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Neutral</td>
      <td>8</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
      <td>0</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Neutral</td>
      <td>4</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Disagree</td>
      <td>8</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Strongly Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One last tweak: some databases (like MS SQL) don't like naming columns with that period in the name. As a work around you can give the <code>json_normalize</code> function a custom separator such as an underscore instead.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> 
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
    <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;choices&quot;</span><span class="p">],</span> 
    <span class="n">meta</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span> 
        <span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;question_id&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;question_text&quot;</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>choice</th>
      <th>number</th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>responses_question_id</th>
      <th>responses_question_text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Strongly Agree</td>
      <td>4</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Strongly Agree</td>
      <td>9</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Agree</td>
      <td>2</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Neutral</td>
      <td>8</td>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
      <td>0</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Neutral</td>
      <td>4</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Disagree</td>
      <td>8</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Strongly Disagree</td>
      <td>7</td>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we'll order the columns from the least nested level on the left all the way to the most nested on the right for easier readability.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[76]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">column_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;respondent_id&quot;</span><span class="p">,</span> <span class="s2">&quot;survey_date&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;responses_question_id&quot;</span><span class="p">,</span> <span class="s2">&quot;responses_question_text&quot;</span><span class="p">,</span> <span class="s2">&quot;choice&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_order</span><span class="p">]</span>
<span class="n">print_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>respondent_id</th>
      <th>survey_date</th>
      <th>email</th>
      <th>responses_question_id</th>
      <th>responses_question_text</th>
      <th>choice</th>
      <th>number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>7YB4ZO864I7</td>
      <td>How does speak beat ever tree?</td>
      <td>Strongly Agree</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8uD0WY155Q9</td>
      <td>How does write popular Mr know develop?</td>
      <td>Agree</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8bN0OP829A8</td>
      <td>Why does democratic represent far my pressure series third?</td>
      <td>Strongly Agree</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>2Rt9mk140E8</td>
      <td>How does understand network old?</td>
      <td>Agree</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9U69hZ538l1</td>
      <td>1994-03-20</td>
      <td>lindsey24@example.com</td>
      <td>8tf2SU934m8</td>
      <td>Why does western next put?</td>
      <td>Neutral</td>
      <td>8</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2CP2AW568v2</td>
      <td>Why does whatever play office move alone class part wish?</td>
      <td>Neutral</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2YV7SR528f0</td>
      <td>Why does which phone return much door?</td>
      <td>Disagree</td>
      <td>7</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>3PJ8eR903v4</td>
      <td>Why does despite be class various great stay Republican person?</td>
      <td>Neutral</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>2GV2kH553o3</td>
      <td>Does become create store store?</td>
      <td>Disagree</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>3A45gW246W1</td>
      <td>1991-07-13</td>
      <td>robert21@example.com</td>
      <td>9aX3NJ910f8</td>
      <td>Which team life although rate science I pattern?</td>
      <td>Strongly Disagree</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parsed-and-ready-to-import">Parsed and ready to import<a class="anchor-link" href="#Parsed-and-ready-to-import">&#182;</a></h2><p>At this point our data is in a simple tabular format and ready to import into a database table with something like <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_sql.html?highlight=to_sql">pandas.to_sql()</a> function, but we'll save that for another post.</p>

</div>
</div>
</div>
 


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dchess-org';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " dchess ",
  "url" : ".",
  "image": "/images/profile.jpg",
  "description": "Code, code, and more code"
}
</script>


</body>
</html>